"use strict";(self.webpackChunkatherp=self.webpackChunkatherp||[]).push([[6629],{86428:(O,I,p)=>{p.d(I,{B:()=>e});const e=(0,p(85094).P1)(f=>f.pagination,f=>f.pagination)},23077:(O,I,p)=>{p.d(I,{p:()=>e});var y=p(5e3),F=p(7903);let e=(()=>{class f{constructor(a){this._paymentMethodsService=a}resolve(a,k){return this._paymentMethodsService.getPaymentMethods()}}return f.\u0275fac=function(a){return new(a||f)(y.LFG(F.o))},f.\u0275prov=y.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()},66629:(O,I,p)=>{p.r(I),p.d(I,{TradeModule:()=>yt});var y=p(35357),F=p(17460),e=p(5e3),f=p(35265);let B=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["trade-purchases"]],decls:1,vars:0,template:function(t,r){1&t&&e._UZ(0,"ath-content-menu")},dependencies:[f.p],encapsulation:2}),o})();var a=p(93075),k=p(86087),U=p(84847),G=p(39646),w=p(77579),j=p(56451),m=p(82722),H=p(78372),v=p(63900),S=p(54004),K=p(86428),C=p(85094);const W=o=>o.purchases,ne=(0,C.P1)(W,o=>o.purchase),N=(0,C.P1)(W,o=>o.purchases);var J=p(71683),Z=p(45840),P=p(95698),x=p(18505),q=p(68421),d=p(59784),g=p(33921);const ie=g.Ps`
    mutation CreatedPurchase($createPurchaseInput: CreatePurchaseInput!) {
        createdPurchase(createPurchaseInput: $createPurchaseInput) {
            code
            createdAt
            currencyId
            id
            paymentMethodId
            paymentStatus
            products {
                cost
                expiration
                expirationDate
                name
                quantity
                uomId
                upc
            }
            status
            supplierId
            total
            userId
            voucherDate
            voucherNo
            voucherTypeId
        }
    }

`,se=g.Ps`
    mutation UpdatePurchase($updatePurchaseInput: UpdatePurchaseInput!) {
        updatedPurchase(updatePurchaseInput: $updatePurchaseInput) {
            id
            code
            createdAt
            currencyId
            paymentMethod
            paymentStatus
            products
            status
            supplierId
            total
            voucherDate
            voucherNo
            voucherTypeId
        }
    }
`,ae=g.Ps`
    mutation RemovePurchase($removePurchaseId: String!) {
        removePurchase(id: $removePurchaseId)
    }
`,ce=g.Ps`
    query FindAllPurchases($offset: Int, $limit: Int, $sort: String, $order: Order, $search: String) {
        findAllPurchases(offset: $offset, limit: $limit, sort: $sort, order: $order, search: $search) {
            ok
            message

            pagination {
                length
                size
                page
            }

            purchases {
                id
                code
                createdAt
                currencyId
                currency {
                    iso
                }
                paymentMethodId
                paymentMethod {
                    name
                }
                paymentStatus
                status
                supplierId
                supplier {
                    name
                }
                total
                voucherDate
                voucherNo
                voucherTypeId
                voucher {
                    name
                }
            }
        }
    }
`,pe=g.Ps`
    query FindPurchaseById($findPurchaseById: String!) {
        purchase(id: $findPurchaseById) {
            id
            code
            createdAt
            currencyId
            paymentMethodId
            paymentStatus
            products
            status
            supplierId
            total
            voucherDate
            voucherNo
            voucherTypeId
        }
    }
`;var V=p(75714),E=p(57261);let L=(()=>{class o{constructor(t,r,n){this.apolloProvider=t,this._snackBar=r,this.store=n,this._apollo=this.apolloProvider.use("BALANC")}createPurchase(t){return this.store.select(N).pipe((0,P.q)(1),(0,v.w)(r=>this._apollo.mutate({mutation:ie,variables:{createPurchaseInput:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:n,data:s})=>{if(n){let l="";n.forEach(u=>l+=`\n ${u.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:l,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const c=(0,Z.Z)(r);c.push(s.createdPurchase),this.store.dispatch((0,q.Lb)({purchases:c}))}))))}getPurchases(t=1,r=5,n="no",s="desc",c=""){return this._apollo.query({query:ce,errorPolicy:"all",variables:{offset:r*(t-1),limit:r,sort:n,order:s,search:c}}).pipe((0,x.b)(({errors:l,data:u})=>{if(l){let b="";l.forEach(z=>b+=`\n ${z.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:b,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}this.store.dispatch((0,q.Lb)({purchases:u.findAllPurchases.purchases})),this.store.dispatch((0,V.Jr)({pagination:u.findAllPurchases.pagination}))}))}getPurchaseById(t){return this._apollo.query({query:pe,variables:{findPurchaseByIdId:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:r,data:n})=>{if(r){let s="";r.forEach(c=>s+=`\n ${c.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:s,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}this.store.dispatch((0,q.tN)({purchase:n.purchase}))}))}updatePurchase(t){return this.store.select(N).pipe((0,P.q)(1),(0,v.w)(r=>this._apollo.mutate({mutation:se,variables:{updatePurchaseInput:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:n,data:s})=>{if(n){let u="";n.forEach(b=>u+=`\n ${b.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:u,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const c=(0,Z.Z)(r);c[r.findIndex(u=>u.id===t.id)]=s.updatedPurchase,this.store.dispatch((0,q.Lb)({purchases:c}))}))))}removePurchase(t){return this.store.select(N).pipe((0,P.q)(1),(0,v.w)(r=>this._apollo.mutate({mutation:ae,variables:{removePurchaseId:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:n})=>{if(n){let l="";n.forEach(u=>l+=`\n ${u.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:l,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const s=(0,Z.Z)(r),c=r.findIndex(l=>l.id===t);s.splice(c,1),this.store.dispatch((0,q.Lb)({purchases:s}))}))))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(g._M),e.LFG(E.ux),e.LFG(C.yh))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var h=p(69808),Q=p(47423),M=p(25245),_=p(67322),D=p(98833);function le(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"div",28)(2,"div",24),e._uU(3),e.qZA(),e.TgZ(4,"div",24),e._uU(5),e.qZA(),e.TgZ(6,"div",24),e._uU(7),e.ALo(8,"date"),e.qZA(),e.TgZ(9,"div",29),e._uU(10),e.qZA(),e.TgZ(11,"div",24),e._uU(12),e.qZA(),e.TgZ(13,"div",24),e._uU(14),e.ALo(15,"currency"),e.qZA(),e.TgZ(16,"div",30),e._uU(17),e.qZA(),e.TgZ(18,"div",31)(19,"button",32),e._UZ(20,"mat-icon",33),e.qZA()()(),e.BQk()),2&o){const t=i.$implicit;e.xp6(3),e.hij(" ",t.voucher.name," "),e.xp6(2),e.hij(" ",t.voucherNo," "),e.xp6(2),e.hij(" ",e.xi3(8,8,t.voucherDate,"dd/MM/yyyy")," "),e.xp6(3),e.hij(" ",t.supplier.name," "),e.xp6(2),e.hij(" ",t.paymentMethod.name," "),e.xp6(2),e.hij(" ",e.gM2(15,11,t.total,"$ ","symbol","1.2-2")," "),e.xp6(3),e.hij(" ",t.status," "),e.xp6(3),e.Q6J("svgIcon","mat_solid:delete")}}function ue(o,i){if(1&o&&(e.ynx(0),e.YNc(1,le,21,16,"ng-container",27),e.BQk()),2&o){const t=i.ngIf,r=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t)("ngForTrackBy",r.trackByFn)}}const me=function(o){return{"pointer-events-none":o}},de=function(){return[5,10,25,100]};function he(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"div",22)(2,"div",23)(3,"div",24),e._uU(4," Comprobante "),e.qZA(),e.TgZ(5,"div",24),e._uU(6," No.Comprobante "),e.qZA(),e.TgZ(7,"div",24),e._uU(8," F.Comprobante "),e.qZA(),e.TgZ(9,"div",25),e._uU(10," Proveedor "),e.qZA(),e.TgZ(11,"div",24),e._uU(12," Tipo de Pago "),e.qZA(),e.TgZ(13,"div",24),e._uU(14," Importe "),e.qZA(),e.TgZ(15,"div",24),e._uU(16," Estado "),e.qZA(),e.TgZ(17,"div",24),e._uU(18," Acciones "),e.qZA()(),e.YNc(19,ue,2,2,"ng-container",19),e.ALo(20,"async"),e.qZA(),e._UZ(21,"mat-paginator",26),e.BQk()),2&o){const t=e.oxw(2);e.xp6(19),e.Q6J("ngIf",e.lcZ(20,7,t.purchases$)),e.xp6(2),e.Q6J("ngClass",e.VKq(9,me,t.isLoading))("length",t.pagination.length)("page",t.pagination.page)("pageSize",t.pagination.size)("pageSizeOptions",e.DdM(11,de))("showFirstLastButtons",!0)}}function ge(o,i){if(1&o&&(e.ynx(0),e.YNc(1,he,22,12,"ng-container",21),e.BQk()),2&o){const t=i.ngIf;e.oxw();const r=e.MAs(31);e.xp6(1),e.Q6J("ngIf",t.length>0)("ngIfElse",r)}}function fe(o,i){1&o&&(e.TgZ(0,"div",34),e._uU(1," \xa1No se ha registrado ninguna compra! "),e.qZA())}let _e=(()=>{class o{constructor(t,r,n,s){this._changeDetectorRef=t,this._fuseConfirmationService=r,this._purchasesService=n,this.store=s,this.isLoading=!1,this.purchases$=(0,G.of)([]),this.searchInputControl=new a.NI,this._unsubscribeAll=new w.x}ngOnInit(){this.store.select(K.B).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.pagination=t,this._changeDetectorRef.markForCheck()}),this.purchases$=this.store.select(N),this.searchInputControl.valueChanges.pipe((0,m.R)(this._unsubscribeAll),(0,H.b)(300),(0,v.w)(t=>(this.isLoading=!0,this._purchasesService.getPurchases(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,t))),(0,S.U)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"no",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,m.R)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,j.T)(this._sort.sortChange,this._paginator.page).pipe((0,v.w)(()=>(this.isLoading=!0,this._purchasesService.getPurchases(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value))),(0,S.U)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}cancelPurchase(t){this._fuseConfirmationService.open({title:"Cancelar compra",message:"\xbfEsta seguro que desea cancelar la compra?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}})}trackByFn(t,r){return r.id||t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO),e.Y36(J.R),e.Y36(L),e.Y36(C.yh))},o.\u0275cmp=e.Xpm({type:o,selectors:[["purchases-list"]],viewQuery:function(t,r){if(1&t&&(e.Gf(k.NW,5),e.Gf(U.YE,5)),2&t){let n;e.iGM(n=e.CRH())&&(r._paginator=n.first),e.iGM(n=e.CRH())&&(r._sort=n.first)}},decls:32,vars:10,consts:[[1,"flex","flex-col","flex-auto","min-w-0","sm:absolute","sm:inset-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","px-6","py-8","border-b","sm:flex-row","flex-0","sm:items-center","sm:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/dashboard",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","md:text-4xl","sm:leading-10"],[1,"flex","items-center","mt-6","shrink-0","sm:mt-0","sm:ml-4","gap-2"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-raised-button","","routerLink","/trade/purchases/form",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[4,"ngIf"],["noPurchases",""],[4,"ngIf","ngIfElse"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","purchase-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900"],[1,"hidden","sm:block","text-center"],[1,"hidden","sm:block"],[1,"z-10","border-b","sm:absolute","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","page","pageSize","pageSizeOptions","showFirstLastButtons"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","purchase-grid","md:px-8"],[1,"hidden","sm:block","truncate"],[1,"hidden","sm:block","text-center","uppercase"],[1,"flex","flex-row","flex-wrap","justify-center","gap-3"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7"],[1,"icon-size-5",3,"svgIcon"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"a",4),e._uU(6,"Inicio"),e.qZA()(),e.TgZ(7,"div",5),e._UZ(8,"mat-icon",6),e.TgZ(9,"a",7),e._uU(10,"Comercial"),e.qZA()(),e.TgZ(11,"div",5),e._UZ(12,"mat-icon",6),e.TgZ(13,"a",7),e._uU(14,"Compras"),e.qZA()()(),e.TgZ(15,"div",8)(16,"h2",9),e._uU(17," Compras "),e.qZA()()(),e.TgZ(18,"div",10)(19,"mat-form-field",11),e._UZ(20,"mat-icon",12)(21,"input",13),e.qZA(),e.TgZ(22,"button",14),e._UZ(23,"mat-icon",15),e.TgZ(24,"span",16),e._uU(25,"Agregar"),e.qZA()()()(),e.TgZ(26,"div",17)(27,"div",18),e.YNc(28,ge,2,2,"ng-container",19),e.ALo(29,"async"),e.YNc(30,fe,2,0,"ng-template",null,20,e.W1O),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(4),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(8),e.Q6J("svgIcon","mat_solid:search"),e.xp6(1),e.Q6J("formControl",r.searchInputControl)("autocomplete","off")("placeholder","Buscar compras"),e.xp6(2),e.Q6J("svgIcon","mat_solid:add"),e.xp6(5),e.Q6J("ngIf",e.lcZ(29,8,r.purchases$)))},dependencies:[y.rH,y.yS,h.mk,h.sg,h.O5,a.Fj,a.JJ,a.oH,Q.lW,M.Hw,_.KE,_.qo,D.Nt,k.NW,U.YE,h.Ov,h.H9,h.uU],encapsulation:2,changeDetection:0}),o})(),ve=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-purchase-details"]],decls:2,vars:0,template:function(t,r){1&t&&(e.TgZ(0,"p"),e._uU(1,"purchase-details works!"),e.qZA())},encapsulation:2}),o})();var X=p(68675),ee=p(17489),xe=p(99987),be=p(96008),ye=p(17264);const te=o=>o.suppliers,A=((0,C.P1)(te,o=>o.supplier),(0,C.P1)(te,o=>o.suppliers));var Ce=p(66592);class Ze{}class Pe{constructor(i,t,r,n,s,c,l){this.name=i,this.uomId=t,this.expiration=r,this.expirationDate=c,this.upc=l,this.cost=n,this.quantity=s}}var oe=p(91079),Ie=p(90508),$=p(86856),Se=p(74107);const Ae=["purchaseNgForm"];function Te(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"mat-option",35),e.NdJ("click",function(){const s=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.addProductToPurchase(s))}),e._uU(1),e.qZA()}if(2&o){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Fe(o,i){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",41)(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"div",42),e._uU(5),e.qZA(),e.TgZ(6,"div",39),e._uU(7," U "),e.qZA(),e.TgZ(8,"div",39)(9,"div",43)(10,"button",44),e.NdJ("click",function(){const n=e.CHM(t),s=n.index,c=n.$implicit,l=e.oxw(2);return e.KtG(l.decrementProductQty(s,c))}),e._UZ(11,"mat-icon",45),e.qZA(),e.TgZ(12,"mat-form-field",46)(13,"input",47),e.NdJ("ngModelChange",function(n){const c=e.CHM(t).$implicit;return e.KtG(c.quantity=n)}),e.qZA()(),e.TgZ(14,"button",44),e.NdJ("click",function(){const n=e.CHM(t),s=n.index,c=n.$implicit,l=e.oxw(2);return e.KtG(l.incrementProductQty(s,c))}),e._UZ(15,"mat-icon",45),e.qZA()()(),e.TgZ(16,"div",48),e._uU(17),e.ALo(18,"number"),e.qZA(),e.TgZ(19,"div",48),e._uU(20),e.ALo(21,"number"),e.qZA(),e.TgZ(22,"div",49)(23,"button",50),e.NdJ("click",function(){const s=e.CHM(t).index,c=e.oxw(2);return e.KtG(c.removeProductToPurchase(s))}),e._UZ(24,"mat-icon",45),e.qZA()()(),e.BQk()}if(2&o){const t=i.$implicit,r=i.index;e.xp6(3),e.hij(" ",r+1," "),e.xp6(2),e.hij(" ",t.name," "),e.xp6(6),e.Q6J("svgIcon","mat_solid:remove"),e.xp6(2),e.Q6J("ngModel",t.quantity),e.xp6(2),e.Q6J("svgIcon","mat_solid:add"),e.xp6(2),e.hij(" ",e.xi3(18,8,t.cost,"1.2-2")," "),e.xp6(3),e.hij(" ",e.xi3(21,11,t.quantity*t.cost,"1.2-2")," "),e.xp6(4),e.Q6J("svgIcon","mat_solid:close")}}function ke(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"div",36)(2,"div",37),e._UZ(3,"div"),e.TgZ(4,"div",38),e._uU(5," Producto "),e.qZA(),e.TgZ(6,"div",39),e._uU(7," Presentaci\xf3n "),e.qZA(),e.TgZ(8,"div",39),e._uU(9," Cantidad "),e.qZA(),e.TgZ(10,"div",39),e._uU(11," Costo "),e.qZA(),e.TgZ(12,"div",39),e._uU(13," Total "),e.qZA(),e.TgZ(14,"div",39),e._uU(15," Quitar "),e.qZA()(),e.YNc(16,Fe,25,14,"ng-container",40),e.qZA(),e.BQk()),2&o){const t=e.oxw();e.xp6(16),e.Q6J("ngForOf",t.purchaseProducts)("ngForTrackBy",t.trackByFn)}}function Ue(o,i){1&o&&(e.TgZ(0,"div",51),e._uU(1," \xa1No ha seleccionado ning\xfan producto a\xfan! "),e.qZA())}function qe(o,i){if(1&o&&(e.TgZ(0,"mat-option",52),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.iso," ")}}function we(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"mat-option",35),e.NdJ("click",function(){const s=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.selectSupplier(s))}),e._uU(1),e.qZA()}if(2&o){const t=i.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.name," ")}}function Ne(o,i){if(1&o&&(e.TgZ(0,"mat-option",52),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function Je(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," El tipo de comprobante es obligatorio "),e.qZA())}function Ee(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," La fecha del comprobante es obligatoria "),e.qZA())}function Qe(o,i){if(1&o&&(e.TgZ(0,"mat-option",52),e._uU(1),e.qZA()),2&o){const t=i.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}function De(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," El tipo de comprobante es obligatorio "),e.qZA())}function Re(o,i){1&o&&(e.TgZ(0,"mat-error"),e._uU(1," El n\xfamero del comprobante es obligatorio "),e.qZA())}let Be=(()=>{class o{constructor(t,r,n,s,c,l){this._changeDetectorRef=t,this._formBuilder=r,this._fuseConfirmationService=n,this._purchasesService=s,this._router=c,this.store=l,this.currencies=[],this.maxDate=new Date,this.paymentMethods=[],this.products=[],this.purchase=new Ze,this.purchaseProducts=[],this.searchProductControl=new a.NI(""),this.searchSupplierControl=new a.NI(""),this.suppliers=[],this.supplierSelected="",this.total=0,this.vouchers=[],this._unsubscribeAll=new w.x}ngOnInit(){this.purchaseForm=this._formBuilder.group({id:new a.NI,currencyId:new a.NI(null,[a.kI.required]),supplierId:new a.NI(this.supplierSelected,[a.kI.required]),voucherTypeId:new a.NI(null,[a.kI.required]),voucherNo:new a.NI(null,[a.kI.required]),voucherDate:new a.NI(null,[a.kI.required]),paymentMethodId:new a.NI(null,[a.kI.required]),products:new a.Oe([])}),this.store.select(ne).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.purchase=t,null!==t&&this.purchaseForm.patchValue(t),this._changeDetectorRef.markForCheck()}),this.store.select(xe.zd).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.currencies=t,this._changeDetectorRef.markForCheck()}),this.store.select(A).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.suppliers=t,this._changeDetectorRef.markForCheck()}),this.store.select(ye.nR).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.products=t,this._changeDetectorRef.markForCheck()}),this.store.select(be.VS).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.paymentMethods=t,this._changeDetectorRef.markForCheck()}),this.store.select(Ce.a).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.vouchers=t,this._changeDetectorRef.markForCheck()}),this.productsFiltered=this.searchProductControl.valueChanges.pipe((0,X.O)(""),(0,S.U)(t=>{const r="string"==typeof t?t:null==t?void 0:t.name;return r?this._filterProducts(r):this.products.slice()})),this.suppliersFiltered=this.searchSupplierControl.valueChanges.pipe((0,X.O)(""),(0,S.U)(t=>{const r="string"==typeof t?t:null==t?void 0:t.name;return r?this._filterSuppliers(r):this.suppliers.slice()}))}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}displayFn(t){return t&&t.name?t.name:""}selectSupplier(t){this.purchaseForm.get("supplierId").setValue(t.id)}addProductToPurchase(t){if(this.purchaseProducts.findIndex(s=>s.productId===t.id)>-1)return void this.searchProductControl.reset();const n=this._mapProductToPurchase(t);this.purchaseProducts.push(n),this.searchProductControl.reset(),this._calculatePurchaseTotal()}incrementProductQty(t,r){const n=r;n.quantity++,this.purchaseProducts[t]=n,this._calculatePurchaseTotal()}decrementProductQty(t,r){const n=r;n.quantity--,this.purchaseProducts[t]=n,this._calculatePurchaseTotal()}removeProductToPurchase(t){this.purchaseProducts.splice(t,1),this._calculatePurchaseTotal()}createPurchase(){let t=this.purchaseForm.getRawValue();t=(0,ee.omit)(t,["id"]),t.products=this.purchaseProducts,t.total=this.total,this._fuseConfirmationService.open({title:"Registrar compra",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{"confirmed"===n&&this._purchasesService.createPurchase(t).pipe((0,m.R)(this._unsubscribeAll)).subscribe(()=>{this._fuseConfirmationService.open({title:"Confirmaci\xf3n",message:"Compra registrada correctamente",icon:{show:!0,name:"mat_solid:done",color:"success"},actions:{confirm:{show:!0,label:"Ok",color:"primary"},cancel:{show:!1}},dismissible:!1}),this._changeDetectorRef.markForCheck(),this._router.navigateByUrl("/trade/purchases/list")})})}_mapProductToPurchase(t){const{name:r,upc:n,uomId:s,cost:c,expiration:l=!0,expirationDate:u}=t;return new Pe(r,s,l,c,1,u,n)}_filterProducts(t){const r=t.toLowerCase();return this.products.filter(n=>n.name.toLowerCase().includes(r))}_filterSuppliers(t){const r=t.toLowerCase();return this.suppliers.filter(n=>n.name.toLowerCase().includes(r))}_calculatePurchaseTotal(){this.total=Number(this.purchaseProducts.reduce((t,r)=>r.cost*r.quantity+t,0).toFixed(2))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO),e.Y36(a.qu),e.Y36(J.R),e.Y36(L),e.Y36(y.F0),e.Y36(C.yh))},o.\u0275cmp=e.Xpm({type:o,selectors:[["purchase-form"]],viewQuery:function(t,r){if(1&t&&e.Gf(Ae,5),2&t){let n;e.iGM(n=e.CRH())&&(r.purchaseNgForm=n.first)}},decls:68,vars:48,consts:[[1,"flex","flex-col","flex-auto","min-w-0"],[1,"flex","flex-col","items-center","p-6"],[1,"flex","flex-col","w-full"],[1,"text-4xl","font-extrabold","leading-tight","tracking-tight"],[1,"grid","grid-flow-row","grid-cols-1","mt-8","sm:grid-cols-6","gap-y-12","sm:gap-x-4","sm:mt-12"],[1,"col-span-4","p-6","shadow","rounded-2xl","bg-card"],[1,"w-full"],["appearance","fill",1,"w-full","fuse-mat-dense"],["matPrefix","",3,"svgIcon"],["type","text","matInput","",3,"formControl","matAutocomplete","placeholder"],[3,"displayWith"],["productsAutocomplete","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],[1,"flex","flex-col","flex-auto","mt-2","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[4,"ngIf","ngIfElse"],["noPurchaseProducts",""],[1,"col-span-2","shadow","rounded-2xl","bg-card"],[1,"flex","items-center","justify-center","w-full","gap-2","p-6","mb-2","font-mono","text-3xl","font-semibold","leading-7","text-white","rounded-t-2xl","bg-jungle-500"],[3,"formGroup"],[3,"formControlName","required","placeholder"],[3,"value",4,"ngFor","ngForOf"],[1,"p-6","space-y-3",3,"formGroup"],["purchaseNgForm","ngForm"],["type","text","matInput","",3,"matAutocomplete","placeholder","required"],["supplierAutocomplete","matAutocomplete"],[1,"flex","flex-col","gap-2","md:flex-row"],[1,"w-full","fuse-mat-dense"],[3,"formControlName","required"],[4,"ngIf"],["matInput","",3,"matDatepicker","formControlName","max","required"],["matIconSuffix","",3,"for"],["voucherDate",""],["matInput","","maxlength","50",3,"type","formControlName","required"],[1,"flex","items-center","justify-end"],["mat-flat-button","",1,"w-full",3,"color","disabled","click"],[3,"value","click"],[1,"grid"],[1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","purchase-products-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-primary","dark:bg-opacity-5"],[1,"hidden","text-left","sm:block"],[1,"hidden","text-center","sm:block"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","purchase-products-grid","md:px-8"],[1,"hidden","truncate","md:block"],[1,"flex","flex-row","items-center","justify-center","gap-2"],["mat-stroked-button","",1,"p-2","leading-6","min-w-7","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],[1,"fuse-mat-dense","fuse-mat-rounded"],["matInput","","type","number","name","quantity",1,"font-mono","font-semibold","text-center",3,"ngModel","ngModelChange"],[1,"hidden","font-mono","text-center","sm:block"],[1,"flex","justify-center"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"],[3,"value"]],template:function(t,r){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4," Registrar Compra "),e.qZA(),e.TgZ(5,"div",4)(6,"div",5)(7,"form",6)(8,"mat-form-field",7),e._UZ(9,"mat-icon",8)(10,"input",9),e.TgZ(11,"mat-autocomplete",10,11),e.YNc(13,Te,2,2,"mat-option",12),e.ALo(14,"async"),e.qZA()()(),e.TgZ(15,"div",13),e.YNc(16,ke,17,2,"ng-container",14),e.YNc(17,Ue,2,0,"ng-template",null,15,e.W1O),e.qZA()(),e.TgZ(19,"div",16)(20,"div",17),e._uU(21),e.ALo(22,"number"),e.TgZ(23,"form",18)(24,"mat-form-field",7)(25,"mat-select",19),e.YNc(26,qe,2,2,"mat-option",20),e.qZA()()()(),e.TgZ(27,"form",21,22)(29,"mat-form-field",7),e._UZ(30,"mat-icon",8)(31,"input",23),e.TgZ(32,"mat-autocomplete",10,24),e.YNc(34,we,2,2,"mat-option",12),e.ALo(35,"async"),e.qZA()(),e.TgZ(36,"div",25)(37,"mat-form-field",26)(38,"mat-label"),e._uU(39,"Tipo de comprobante"),e.qZA(),e.TgZ(40,"mat-select",27),e.YNc(41,Ne,2,2,"mat-option",20),e.qZA(),e.YNc(42,Je,2,0,"mat-error",28),e.qZA(),e.TgZ(43,"mat-form-field",26)(44,"mat-label"),e._uU(45,"Fecha del comprobante"),e.qZA(),e._UZ(46,"input",29),e.TgZ(47,"mat-hint"),e._uU(48,"DD/MM/YYYY"),e.qZA(),e._UZ(49,"mat-datepicker-toggle",30)(50,"mat-datepicker",null,31),e.YNc(52,Ee,2,0,"mat-error",28),e.qZA()(),e.TgZ(53,"div",25)(54,"mat-form-field",26)(55,"mat-label"),e._uU(56,"M\xe9todo de pago"),e.qZA(),e.TgZ(57,"mat-select",27),e.YNc(58,Qe,2,2,"mat-option",20),e.qZA(),e.YNc(59,De,2,0,"mat-error",28),e.qZA(),e.TgZ(60,"mat-form-field",26)(61,"mat-label"),e._uU(62,"N\xfamero del comprobante"),e.qZA(),e._UZ(63,"input",32),e.YNc(64,Re,2,0,"mat-error",28),e.qZA()(),e.TgZ(65,"div",33)(66,"button",34),e.NdJ("click",function(){return r.createPurchase()}),e._uU(67," Registrar "),e.qZA()()()()()()()()),2&t){const n=e.MAs(12),s=e.MAs(18),c=e.MAs(33),l=e.MAs(51);e.xp6(9),e.Q6J("svgIcon","mat_solid:search"),e.xp6(1),e.Q6J("formControl",r.searchProductControl)("matAutocomplete",n)("placeholder","Buscar productos"),e.xp6(1),e.Q6J("displayWith",r.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(14,41,r.productsFiltered)),e.xp6(3),e.Q6J("ngIf",r.purchaseProducts.length>0)("ngIfElse",s),e.xp6(5),e.hij(" ",e.xi3(22,43,r.total,"1.2-2")," "),e.xp6(2),e.Q6J("formGroup",r.purchaseForm),e.xp6(2),e.Q6J("formControlName","currencyId")("required",!0)("placeholder","Moneda"),e.xp6(1),e.Q6J("ngForOf",r.currencies),e.xp6(1),e.Q6J("formGroup",r.purchaseForm),e.xp6(3),e.Q6J("svgIcon","mat_solid:search"),e.xp6(1),e.Q6J("matAutocomplete",c)("placeholder","Buscar proveedor")("required",!0),e.xp6(1),e.Q6J("displayWith",r.displayFn),e.xp6(2),e.Q6J("ngForOf",e.lcZ(35,46,r.suppliersFiltered)),e.xp6(6),e.Q6J("formControlName","voucherTypeId")("required",!0),e.xp6(1),e.Q6J("ngForOf",r.vouchers),e.xp6(1),e.Q6J("ngIf",r.purchaseForm.get("voucherTypeId").hasError("required")),e.xp6(4),e.Q6J("matDatepicker",l)("formControlName","voucherDate")("max",r.maxDate)("required",!0),e.xp6(3),e.Q6J("for",l),e.xp6(3),e.Q6J("ngIf",r.purchaseForm.get("voucherDate").hasError("required")),e.xp6(5),e.Q6J("formControlName","paymentMethodId")("required",!0),e.xp6(1),e.Q6J("ngForOf",r.paymentMethods),e.xp6(1),e.Q6J("ngIf",r.purchaseForm.get("paymentMethodId").hasError("required")),e.xp6(4),e.Q6J("type","text")("formControlName","voucherNo")("required",!0),e.xp6(1),e.Q6J("ngIf",r.purchaseForm.get("voucherNo").hasError("required")),e.xp6(2),e.Q6J("color","primary")("disabled",r.purchaseForm.pristine||r.purchaseForm.invalid||0===r.purchaseProducts.length)}},dependencies:[h.sg,h.O5,a._Y,a.Fj,a.wV,a.JJ,a.JL,a.Q7,a.nD,a.On,a.F,a.oH,a.sg,a.u,oe.XC,oe.ZL,Ie.ey,Q.lW,$.Mq,$.hl,$.nW,M.Hw,_.TO,_.KE,_.bx,_.hX,_.qo,D.Nt,Se.gD,h.Ov,h.JJ],encapsulation:2,changeDetection:0}),o})();var Le=p(63844);class Me{}var R=p(48966),T=p(89186);const $e=g.Ps`
    mutation CreateSupplier($createSupplierInput: CreateSupplierInput!) {
        createSupplier(createSupplierInput: $createSupplierInput) {
            ok
            message

            supplier {
                id
                active
                code
                email
                name
                nit
                phone
            }
        }
    }
`,Ye=g.Ps`
    mutation UpdateSupplier($updateSupplierInput: UpdateSupplierInput!) {
        updateSupplier(updateSupplierInput: $updateSupplierInput) {

            ok
            message

            supplier {
                id
                active
                code
                email
                name
                nit
                phone
            }
        }
    }
`,ze=g.Ps`
    mutation Mutation($updateEntityStatusInput: UpdateEntityStatusInput!) {
        updateSupplierStatus(updateEntityStatusInput: $updateEntityStatusInput)
    }
`,Oe=g.Ps`
    mutation RemoveSupplier($removeSupplierId: String!) {
        removeSupplier(id: $removeSupplierId)
    }
`,Ge=g.Ps`
    query FindAllSuppliers($offset: Int, $limit: Int, $sort: String, $order: Order, $search: String) {
        findAllSuppliers(offset: $offset, limit: $limit, sort: $sort, order: $order, search: $search) {
            ok
            message

            pagination {
                length
                size
                page
            }

            suppliers {
                id
                active
                code
                email
                name
                nit
                phone
            }
        }
    }
`,je=g.Ps`
    query FindSupplierById($findSupplierById: String!) {
        supplier(id: $findSupplierById) {
            id
            active
            code
            email
            name
            nit
            phone
        }
    }
`;let Y=(()=>{class o{constructor(t,r,n){this.apolloProvider=t,this._snackBar=r,this.store=n,this._apollo=this.apolloProvider.use("BALANC")}createSupplier(t){return this.store.select(A).pipe((0,P.q)(1),(0,v.w)(r=>this._apollo.mutate({mutation:$e,variables:{createSupplierInput:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:n,data:s})=>{if(n){let l="";n.forEach(u=>l+=`\n ${u.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:l,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const c=(0,Z.Z)(r);c.push(s.createSupplier.supplier),this.store.dispatch((0,T.bz)({suppliers:c}))}))))}getSuppliers(t=1,r=20,n="code",s="asc",c=""){return this._apollo.query({query:Ge,errorPolicy:"all",variables:{offset:r*(t-1),limit:r,sort:n,order:s,search:c}}).pipe((0,x.b)(({errors:l,data:u})=>{if(l){let b="";l.forEach(z=>b+=`\n ${z.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:b,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}this.store.dispatch((0,T.bz)({suppliers:u.findAllSuppliers.suppliers})),this.store.dispatch((0,V.Jr)({pagination:u.findAllSuppliers.pagination}))}))}getSupplierById(t){return this._apollo.query({query:je,variables:{findSupplierByIdId:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:r,data:n})=>{if(r){let s="";r.forEach(c=>s+=`\n ${c.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:s,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}this.store.dispatch((0,T.n2)({supplier:n.supplier}))}))}updateSupplier(t){return this.store.select(A).pipe((0,P.q)(1),(0,v.w)(r=>this._apollo.mutate({mutation:Ye,variables:{updateSupplierInput:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:n,data:s})=>{if(n){let u="";n.forEach(b=>u+=`\n ${b.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:u,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const c=(0,Z.Z)(r);c[r.findIndex(u=>u.id===t.id)]=s.updateSupplier.supplier,this.store.dispatch((0,T.bz)({suppliers:c}))}))))}updatesSupplierStatus(t){return this.store.select(A).pipe((0,P.q)(1),(0,v.w)(r=>this._apollo.mutate({mutation:ze,variables:{updateEntityStatusInput:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:n})=>{if(n){let l="";n.forEach(u=>l+=`\n ${u.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:l,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}const s=(0,Z.Z)(r);s[r.findIndex(l=>l.id===t.id)].active=t.active,this.store.dispatch((0,T.bz)({suppliers:s}))}))))}removeSupplier(t){return this.store.select(A).pipe((0,P.q)(1),(0,v.w)(r=>this._apollo.mutate({mutation:Oe,variables:{removeSupplierId:t},errorPolicy:"all"}).pipe((0,x.b)(({errors:n,data:s})=>{if(n){let c="";n.forEach(l=>c+=`\n ${l.message}.`),this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:1e4,data:{message:c,title:"Error",type:"error",svgIcon:"mat_solid:error"}})}if(s){const c=(0,Z.Z)(r),l=r.findIndex(u=>u.id===t);c.splice(l,1),this.store.dispatch((0,T.bz)({suppliers:c}))}}))))}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(g._M),e.LFG(E.ux),e.LFG(C.yh))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function He(o,i){1&o&&(e.TgZ(0,"h2",6),e._uU(1,"Agregar proveedor"),e.qZA())}function Ke(o,i){1&o&&(e.TgZ(0,"h2",6),e._uU(1,"Editar proveedor"),e.qZA())}function We(o,i){if(1&o&&(e.TgZ(0,"div",7)(1,"div",8)(2,"form",9)(3,"div",10)(4,"mat-form-field",11)(5,"mat-label"),e._uU(6,"Nombre"),e.qZA(),e._UZ(7,"input",12),e.qZA(),e.TgZ(8,"mat-form-field",11)(9,"mat-label"),e._uU(10,"N\xfamero de identificaci\xf3n tributaria"),e.qZA(),e._UZ(11,"input",12),e.qZA(),e.TgZ(12,"mat-form-field",11)(13,"mat-label"),e._uU(14,"Correo electr\xf3nico"),e.qZA(),e._UZ(15,"input",13),e.qZA(),e.TgZ(16,"mat-form-field",11)(17,"mat-label"),e._uU(18,"Tel\xe9fono"),e.qZA(),e._UZ(19,"input",14),e.TgZ(20,"mat-hint"),e._uU(21,"Debe incluir +53 al inicio del tel\xe9fono"),e.qZA()()()()()()),2&o){const t=e.oxw();e.xp6(2),e.Q6J("formGroup",t.supplierForm)("autocomplete","off"),e.xp6(5),e.Q6J("formControlName","name"),e.xp6(4),e.Q6J("formControlName","nit"),e.xp6(4),e.Q6J("formControlName","email"),e.xp6(4),e.Q6J("formControlName","phone")}}function Ve(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.updateSupplier())}),e._uU(1,"Actualizar"),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("disabled",t.supplierForm.invalid)("color","primary")}}function Xe(o,i){if(1&o){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.createSupplier())}),e._uU(1,"Agregar"),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("disabled",t.supplierForm.invalid)("color","primary")}}function et(o,i){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",15)(2,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.closeDialog())}),e._uU(3,"Cancelar"),e.qZA(),e.YNc(4,Ve,2,2,"button",17),e.YNc(5,Xe,2,2,"button",17),e.qZA(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("color","warn"),e.xp6(2),e.Q6J("ngIf","edit"===t.data.dialogMode),e.xp6(1),e.Q6J("ngIf","add"===t.data.dialogMode)}}let tt=(()=>{class o{constructor(t,r,n,s,c,l,u){this.data=t,this._suppliersService=r,this._changeDetectorRef=n,this._dialogRef=s,this._formBuilder=c,this._fuseConfirmationService=l,this._snackBar=u,this._unsubscribeAll=new w.x,this.dialogMode=t.dialogMode,this.supplier=this.data.supplier}ngOnInit(){this.supplierForm=this._formBuilder.group({id:new a.NI,name:new a.NI(null,[a.kI.required,a.kI.minLength(3),a.kI.maxLength(150)]),nit:new a.NI(null,[a.kI.required,a.kI.maxLength(20)]),email:new a.NI(null,[a.kI.required,a.kI.email]),phone:new a.NI(null,[a.kI.required,a.kI.maxLength(15),a.kI.pattern("^((\\+53)?\\d{8})?$")])}),null!==this.supplier.name&&this.supplierForm.patchValue(this.supplier)}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}closeDialog(){this._dialogRef.close()}createSupplier(){let t=this.supplierForm.getRawValue();t=(0,ee.omit)(t,["id"]),this._fuseConfirmationService.open({title:"Crear categor\xeda",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{"confirmed"===n&&this._suppliersService.createSupplier(t).pipe((0,m.R)(this._unsubscribeAll)).subscribe(({data:s})=>{this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:s.createSupplier.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this._changeDetectorRef.markForCheck(),this.closeDialog()})})}updateSupplier(){const t=this.supplierForm.getRawValue();this._fuseConfirmationService.open({title:"Categor\xeda",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,m.R)(this._unsubscribeAll)).subscribe(n=>{"confirmed"===n&&this._suppliersService.updateSupplier(t).pipe((0,m.R)(this._unsubscribeAll)).subscribe(({data:s})=>{this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:s.updateSupplier.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this.closeDialog(),this._changeDetectorRef.markForCheck()})})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(R.WI),e.Y36(Y),e.Y36(e.sBO),e.Y36(R.so),e.Y36(a.qu),e.Y36(J.R),e.Y36(E.ux))},o.\u0275cmp=e.Xpm({type:o,selectors:[["supplier-dialog"]],decls:9,vars:4,consts:[[1,"relative","flex","flex-col","w-full","max-h-screen"],[1,"flex","flex-col","items-center","px-8","pt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left"],["mat-dialog-title","",4,"ngIf"],[1,"flex","flex-col","items-center","flex-auto","w-full","px-8","pb-6"],["class","w-full overflow-hidden",4,"ngIf"],[4,"ngIf"],["mat-dialog-title",""],[1,"w-full","overflow-hidden"],[1,"flex","border-t"],[1,"flex","flex-col","w-full","pt-8",3,"formGroup","autocomplete"],[1,"flex","flex-col","flex-auto","gap-4"],[1,"w-full","fuse-mat-dense"],["matInput","","type","text",3,"formControlName"],["matInput","","type","email",3,"formControlName"],["matInput","","type","tel",3,"formControlName"],[1,"flex","items-center","justify-between","w-full","px-8","py-4"],["mat-button","",1,"-ml-4",3,"color","click"],["mat-flat-button","",3,"disabled","color","click",4,"ngIf"],["mat-flat-button","",3,"disabled","color","click"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0),e.ynx(1),e.TgZ(2,"div",1),e.YNc(3,He,2,0,"h2",2),e.YNc(4,Ke,2,0,"h2",2),e.qZA(),e.BQk(),e.TgZ(5,"div",3),e.ynx(6),e.YNc(7,We,22,6,"div",4),e.BQk(),e.qZA(),e.YNc(8,et,6,3,"ng-container",5),e.qZA()),2&t&&(e.xp6(3),e.Q6J("ngIf",!r.data.supplier.id&&"add"===r.dialogMode),e.xp6(1),e.Q6J("ngIf",r.data.supplier.id&&"edit"===r.dialogMode),e.xp6(3),e.Q6J("ngIf","view"!==r.dialogMode),e.xp6(1),e.Q6J("ngIf","view"!==r.data.dialogMode))},dependencies:[h.O5,a._Y,a.Fj,a.JJ,a.JL,a.sg,a.u,Q.lW,R.uh,_.KE,_.bx,_.hX,D.Nt],encapsulation:2}),o})();var ot=p(20773),rt=p(32368);function nt(o,i){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-slide-toggle",36),e.NdJ("change",function(n){e.CHM(t);const s=e.oxw(),c=s.$implicit,l=s.index,u=e.oxw(4);return e.KtG(u.updateSupplierStatus(n,c,l))}),e.qZA(),e.BQk()}if(2&o){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("checked",t.active)("color","primary")}}function it(o,i){1&o&&(e.ynx(0),e._UZ(1,"mat-spinner",37),e.BQk()),2&o&&(e.xp6(1),e.Q6J("diameter",20)("color","primary"))}function st(o,i){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",30)(2,"div",31),e._uU(3),e.qZA(),e.TgZ(4,"div",32),e._uU(5),e.qZA(),e.TgZ(6,"div",26),e._uU(7),e.qZA(),e.TgZ(8,"div",26),e._uU(9),e.qZA(),e.TgZ(10,"div",26),e._uU(11),e.qZA(),e.TgZ(12,"div",27),e.YNc(13,nt,2,2,"ng-container",19),e.YNc(14,it,2,2,"ng-container",19),e.qZA(),e.TgZ(15,"div",33)(16,"button",34),e.NdJ("click",function(){const s=e.CHM(t).$implicit,c=e.oxw(4);return e.KtG(c.openDialog(s,"edit"))}),e._UZ(17,"mat-icon",35),e.qZA(),e.TgZ(18,"button",34),e.NdJ("click",function(){const s=e.CHM(t).$implicit,c=e.oxw(4);return e.KtG(c.deleteSupplier(s.id))}),e._UZ(19,"mat-icon",35),e.qZA()()(),e.BQk()}if(2&o){const t=i.$implicit,r=i.index,n=e.oxw(4);e.xp6(3),e.hij(" ",t.code," "),e.xp6(2),e.hij(" ",t.name," "),e.xp6(2),e.hij(" ",t.nit," "),e.xp6(2),e.hij(" ",t.phone," "),e.xp6(2),e.hij(" ",t.email," "),e.xp6(2),e.Q6J("ngIf",!(n.isSlideLoading&&n.selectedSlide===r)),e.xp6(1),e.Q6J("ngIf",n.isSlideLoading&&n.selectedSlide===r),e.xp6(3),e.Q6J("svgIcon","mat_solid:edit"),e.xp6(2),e.Q6J("svgIcon","mat_solid:delete")}}function at(o,i){if(1&o&&(e.ynx(0),e.YNc(1,st,20,9,"ng-container",29),e.BQk()),2&o){const t=i.ngIf,r=e.oxw(3);e.xp6(1),e.Q6J("ngForOf",t)("ngForTrackBy",r.trackByFn)}}const ct=function(o){return{"pointer-events-none":o}},pt=function(){return[5,10,25,100]};function lt(o,i){if(1&o&&(e.ynx(0),e.TgZ(1,"div",22)(2,"div",23)(3,"div",24),e._uU(4," C\xf3digo "),e.qZA(),e.TgZ(5,"div",25),e._uU(6," Nombre "),e.qZA(),e.TgZ(7,"div",26),e._uU(8," NIT "),e.qZA(),e.TgZ(9,"div",27),e._uU(10," Tel\xe9fono "),e.qZA(),e.TgZ(11,"div",27),e._uU(12," Correo "),e.qZA(),e.TgZ(13,"div",27),e._uU(14," Activo "),e.qZA(),e.TgZ(15,"div",26),e._uU(16,"Detalles"),e.qZA()(),e.YNc(17,at,2,2,"ng-container",19),e.ALo(18,"async"),e.qZA(),e._UZ(19,"mat-paginator",28),e.BQk()),2&o){const t=e.oxw(2);e.xp6(3),e.Q6J("mat-sort-header","code"),e.xp6(2),e.Q6J("mat-sort-header","name"),e.xp6(12),e.Q6J("ngIf",e.lcZ(18,9,t.suppliers$)),e.xp6(2),e.Q6J("ngClass",e.VKq(11,ct,t.isLoading))("length",t.pagination.length)("page",t.pagination.page)("pageSize",t.pagination.size)("pageSizeOptions",e.DdM(13,pt))("showFirstLastButtons",!0)}}function ut(o,i){if(1&o&&(e.ynx(0),e.YNc(1,lt,20,14,"ng-container",21),e.BQk()),2&o){const t=i.ngIf;e.oxw();const r=e.MAs(27);e.xp6(1),e.Q6J("ngIf",t.length>0)("ngIfElse",r)}}function mt(o,i){1&o&&(e.TgZ(0,"div",38),e._uU(1," \xa1No se ha creado ning\xfan proveedor! "),e.qZA())}let dt=(()=>{class o{constructor(t,r,n,s,c,l){this._changeDetectorRef=t,this._dialog=r,this._fuseConfirmationService=n,this._snackBar=s,this._suppliersService=c,this.store=l,this.isLoading=!1,this.suppliers$=(0,G.of)([]),this.searchInputControl=new a.NI,this.isSlideLoading=!1,this.selectedSlide=null,this.supplier=new Me,this._unsubscribeAll=new w.x}ngOnInit(){this.store.select(K.B).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.pagination=t,this._changeDetectorRef.markForCheck()}),this.suppliers$=this.store.select(A),this.searchInputControl.valueChanges.pipe((0,m.R)(this._unsubscribeAll),(0,H.b)(300),(0,v.w)(t=>(this.isLoading=!0,this._suppliersService.getSuppliers(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,t))),(0,S.U)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:"code",start:"asc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,m.R)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,j.T)(this._sort.sortChange,this._paginator.page).pipe((0,v.w)(()=>(this.isLoading=!0,this._suppliersService.getSuppliers(this._paginator.pageIndex+1,this._paginator.pageSize,this._sort.active,this._sort.direction,this.searchInputControl.value))),(0,S.U)(()=>{this.isLoading=!1})).subscribe())}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}updateSupplierStatus(t,r,n){this.isSlideLoading=!0,this.selectedSlide=n,this._suppliersService.updatesSupplierStatus({id:r.id,active:t.checked}).subscribe(({data:s})=>{this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:s.updateSupplierStatus,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this.isSlideLoading=!1,this.selectedSlide=null,this._changeDetectorRef.markForCheck()})}deleteSupplier(t){this._fuseConfirmationService.open({title:"Eliminar proveedor",message:"\xbfEsta seguro que desea eliminar el proveedor?",icon:{show:!0,name:"mat_solid:question_mark",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(n=>{"confirmed"===n&&this._suppliersService.removeSupplier(t).pipe((0,m.R)(this._unsubscribeAll)).subscribe(({data:s})=>{this._snackBar.openFromComponent(d.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:s.removeSupplier,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}})}),this._changeDetectorRef.markForCheck()})}openDialog(t,r){this._dialog.open(tt,{data:{supplier:t,dialogMode:r},panelClass:"ath-dialog-panel"})}trackByFn(t,r){return r.id||t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(e.sBO),e.Y36(R.uw),e.Y36(J.R),e.Y36(E.ux),e.Y36(Y),e.Y36(C.yh))},o.\u0275cmp=e.Xpm({type:o,selectors:[["suppliers"]],viewQuery:function(t,r){if(1&t&&(e.Gf(k.NW,5),e.Gf(U.YE,5)),2&t){let n;e.iGM(n=e.CRH())&&(r._paginator=n.first),e.iGM(n=e.CRH())&&(r._sort=n.first)}},decls:28,vars:9,consts:[[1,"flex","flex-col","flex-auto","min-w-0","sm:absolute","sm:inset-0","sm:overflow-hidden","bg-card","dark:bg-transparent"],[1,"relative","flex","flex-col","px-6","py-8","border-b","sm:flex-row","flex-0","sm:items-center","sm:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex","flex-wrap","items-center","font-medium"],["routerLink","/dashboard",1,"whitespace-nowrap","text-primary-500"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","md:text-4xl","sm:leading-10"],[1,"flex","items-center","gap-2","mt-6","shrink-0","sm:mt-0","sm:ml-4"],[1,"fuse-mat-dense","fuse-mat-rounded","min-w-64"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-raised-button","",1,"text-white","bg-gradient-to-r","from-primary-500","to-primary-700",3,"click"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[1,"flex","flex-auto","overflow-hidden"],[1,"flex","flex-col","flex-auto","overflow-hidden","sm:mb-18","sm:overflow-y-auto"],[4,"ngIf"],["noSuppliers",""],[4,"ngIf","ngIfElse"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","supplier-grid","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-slate-900"],[1,"hidden","md:block",3,"mat-sort-header"],[1,"hidden","sm:block",3,"mat-sort-header"],[1,"hidden","text-center","sm:block"],[1,"hidden","text-center","lg:block"],[1,"z-10","border-b","sm:absolute","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","page","pageSize","pageSizeOptions","showFirstLastButtons"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","supplier-grid","md:px-8"],[1,"hidden","md:block"],[1,"truncate"],[1,"flex","flex-row","flex-wrap","justify-center","gap-3"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],[1,"icon-size-5",3,"svgIcon"],[3,"checked","color","change"],[3,"diameter","color"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(t,r){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div")(5,"a",4),e._uU(6,"Inicio"),e.qZA()(),e.TgZ(7,"div",5),e._UZ(8,"mat-icon",6),e.TgZ(9,"a",7),e._uU(10,"Proveedores"),e.qZA()()(),e.TgZ(11,"div",8)(12,"h2",9),e._uU(13," Proveedores "),e.qZA()()(),e.TgZ(14,"div",10)(15,"mat-form-field",11),e._UZ(16,"mat-icon",12)(17,"input",13),e.qZA(),e.TgZ(18,"button",14),e.NdJ("click",function(){return r.openDialog(r.supplier,"add")}),e._UZ(19,"mat-icon",15),e.TgZ(20,"span",16),e._uU(21,"Agregar"),e.qZA()()()(),e.TgZ(22,"div",17)(23,"div",18),e.YNc(24,ut,2,2,"ng-container",19),e.ALo(25,"async"),e.YNc(26,mt,2,0,"ng-template",null,20,e.W1O),e.qZA()()()),2&t&&(e.xp6(8),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(8),e.Q6J("svgIcon","mat_solid:search"),e.xp6(1),e.Q6J("formControl",r.searchInputControl)("autocomplete","off")("placeholder","Buscar proveedores"),e.xp6(2),e.Q6J("svgIcon","mat_solid:add"),e.xp6(5),e.Q6J("ngIf",e.lcZ(25,7,r.suppliers$)))},dependencies:[y.yS,h.mk,h.sg,h.O5,a.Fj,a.JJ,a.oH,Q.lW,M.Hw,_.KE,_.qo,D.Nt,k.NW,ot.Ou,rt.Rr,U.YE,U.nU,h.Ov],encapsulation:2,data:{animation:Le.L},changeDetection:0}),o})();var ht=p(98440),gt=p(95259);let ft=(()=>{class o{constructor(t){this._purchasesService=t}resolve(t,r){return this._purchasesService.getPurchases()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(L))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),re=(()=>{class o{constructor(t){this._suppliersService=t}resolve(t,r){return this._suppliersService.getSuppliers()}}return o.\u0275fac=function(t){return new(t||o)(e.LFG(Y))},o.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var _t=p(90810),vt=p(23077),xt=p(25158);const bt=[{path:"suppliers",component:dt,resolve:{suppliers:re}},{path:"purchases",component:B},{path:"purchases/list",component:_e,resolve:{purchases:ft}},{path:"purchases/form",component:Be,resolve:{currencies:_t.Y,merchant:ht.d4,paymentMethods:vt.p,products:gt.SE,suppliers:re,vouchers:xt.p}},{path:"purchases/details",component:ve}];let yt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[y.Bz.forChild(bt),F.m]}),o})()}}]);