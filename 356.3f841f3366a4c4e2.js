"use strict";(self.webpackChunkatherp=self.webpackChunkatherp||[]).push([[356],{92356:(Le,Z,r)=>{r.r(Z),r.d(Z,{RolesModule:()=>Se});var f=r(35357),S=r(17460),w=r(62127),L=r(15861),l=r(93075),T=r(86087),C=r(84847),y=r(77579),O=r(39646),B=r(56451),m=r(82722),k=r(78372),A=r(63900),I=r(54004),E=r(63844),q=r(22594),z=r(86428),J=r(60628),x=r(59784);class j{clear(){this.id=null,this.name="",this.permissions=[],this.isCoreRole=!1,this.checked=!1,this.active=!1}}var e=r(5e3),Q=r(71683),F=r(23166),U=r(57261),D=r(85094),g=r(69808),N=r(29071),M=r(47423),P=r(25245),u=r(67322),Y=r(98833),G=r(20773),H=r(32368),K=r(1235);const $=function(){return["new"]};function V(n,s){if(1&n&&(e.TgZ(0,"div",19)(1,"mat-form-field",20),e._UZ(2,"mat-icon",21)(3,"input",22),e.qZA(),e.TgZ(4,"button",23),e._UZ(5,"mat-icon",24),e.TgZ(6,"span",25),e._uU(7,"Nuevo"),e.qZA()()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("svgIcon","heroicons_solid:search"),e.xp6(1),e.Q6J("formControl",t.searchInputControl)("autocomplete","off")("placeholder","Buscar rol"),e.xp6(1),e.Q6J("routerLink",e.DdM(6,$)),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:plus")}}function W(n,s){1&n&&e._UZ(0,"div")}function X(n,s){1&n&&(e.TgZ(0,"div",34)(1,"span"),e._uU(2,"Activo"),e.qZA()()),2&n&&e.Q6J("mat-sort-header","active")}function ee(n,s){1&n&&e._UZ(0,"mat-icon",40),2&n&&e.Q6J("color","primary")}function te(n,s){1&n&&e._UZ(0,"div")}function ne(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"mat-slide-toggle",42),e.NdJ("change",function(i){e.CHM(t);const a=e.oxw(2),c=a.$implicit,d=a.index,_=e.oxw(3);return e.KtG(_.updateRoleStatus(i,c,d))}),e.qZA(),e.BQk()}if(2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("checked",t.active)("color","primary")}}function oe(n,s){1&n&&(e.ynx(0),e._UZ(1,"mat-spinner",43),e.BQk()),2&n&&(e.xp6(1),e.Q6J("diameter",20)("color","primary"))}function ie(n,s){if(1&n&&(e.TgZ(0,"div",41),e.YNc(1,ne,2,2,"ng-container",16),e.YNc(2,oe,2,2,"ng-container",16),e.qZA()),2&n){const t=e.oxw().index,o=e.oxw(3);e.xp6(1),e.Q6J("ngIf",!(o.isLoading&&o.selectedSlide===t)),e.xp6(1),e.Q6J("ngIf",o.isLoading&&o.selectedSlide===t)}}function se(n,s){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",47),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2).$implicit,a=e.oxw(3);return e.KtG(a.deleteRole(i))}),e._UZ(2,"mat-icon",46),e.qZA(),e.BQk()}2&n&&(e.xp6(2),e.Q6J("svgIcon","heroicons_solid:trash"))}const re=function(n){return[n]},ae=function(){return["Super Administrador"]};function le(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"div",44)(2,"button",45),e._UZ(3,"mat-icon",46),e.qZA(),e.YNc(4,se,3,1,"ng-container",30),e.qZA(),e.BQk()),2&n){const t=e.oxw().$implicit;e.xp6(2),e.Q6J("routerLink",e.VKq(3,re,t.id)),e.xp6(1),e.Q6J("svgIcon","heroicons_solid:pencil"),e.xp6(1),e.Q6J("ngxPermissionsExcept",e.DdM(5,ae))}}const h=function(){return["Due\xf1o"]};function ce(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"div",35)(2,"div",36),e.YNc(3,ee,1,1,"mat-icon",37),e._uU(4),e.qZA(),e.TgZ(5,"div",38),e._uU(6),e.qZA(),e.YNc(7,te,1,0,"div",30),e.YNc(8,ie,3,2,"div",39),e.YNc(9,le,5,6,"ng-container",16),e.qZA(),e.BQk()),2&n){const t=s.$implicit;e.xp6(3),e.Q6J("ngIf",t.isCoreRole),e.xp6(1),e.hij(" ",t.name," "),e.xp6(2),e.hij(" ",t.description," "),e.xp6(1),e.Q6J("ngxPermissionsExcept",e.DdM(6,h)),e.xp6(1),e.Q6J("ngxPermissionsOnly",e.DdM(7,h)),e.xp6(1),e.Q6J("ngIf",!t.isCoreRole)}}function me(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"div",27)(2,"div",28)(3,"div",29),e._uU(4," Nombre "),e.qZA(),e.TgZ(5,"div"),e._uU(6,"Descripci\xf3n"),e.qZA(),e.YNc(7,W,1,0,"div",30),e.YNc(8,X,3,1,"div",31),e.TgZ(9,"div",32),e._uU(10,"Acci\xf3n"),e.qZA()(),e.YNc(11,ce,10,8,"ng-container",33),e.qZA(),e.BQk()),2&n){const t=e.oxw().ngIf,o=e.oxw();e.xp6(3),e.Q6J("mat-sort-header","name"),e.xp6(4),e.Q6J("ngxPermissionsExcept",e.DdM(5,h)),e.xp6(1),e.Q6J("ngxPermissionsOnly",e.DdM(6,h)),e.xp6(3),e.Q6J("ngForOf",t)("ngForTrackBy",o.trackByFn)}}function de(n,s){if(1&n&&(e.ynx(0),e.YNc(1,me,12,7,"ng-container",26),e.BQk()),2&n){const t=s.ngIf;e.oxw();const o=e.MAs(27);e.xp6(1),e.Q6J("ngIf",t.length>0)("ngIfElse",o)}}const pe=function(n){return{"pointer-events-none":n}},ge=function(){return[10,25,50,100]};function ue(n,s){if(1&n&&e._UZ(0,"mat-paginator",49),2&n){const t=e.oxw(2);e.Q6J("ngClass",e.VKq(6,pe,t.isLoading))("length",t.pagination.length)("pageIndex",t.pagination.page)("pageSize",t.pagination.size)("pageSizeOptions",e.DdM(8,ge))("showFirstLastButtons",!0)}}function fe(n,s){if(1&n&&(e.ynx(0),e.YNc(1,ue,1,9,"mat-paginator",48),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.pagination.length>0)}}function he(n,s){1&n&&(e.TgZ(0,"div",50),e._uU(1," \xa1A\xfan ha creado ning\xfan rol a\xfan! "),e.qZA())}let _e=(()=>{class n{constructor(t,o,i,a,c){this._changeDetectorRef=t,this._fuseConfirmationService=o,this._roleService=i,this._snackBar=a,this.store=c,this.emptyRole=new j,this.isLoading=!1,this.selectedSlide=null,this.searchInputControl=new l.p4,this._unsubscribeAll=new y.x,this.emptyRole.clear()}ngOnInit(){this.roles$=this.store.select(J.g$),this.store.select(q.Qs).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.currentMerchant=t,this._changeDetectorRef.markForCheck()}),this.store.select(z.B).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.pagination=t,this._changeDetectorRef.markForCheck()}),this.searchInputControl.valueChanges.pipe((0,m.R)(this._unsubscribeAll),(0,k.b)(300),(0,A.w)(t=>t?(this.isLoading=!0,this._roleService.findAllRoles(0,10,"name","asc",t)):(0,O.of)([])),(0,I.U)(()=>{this.isLoading=!1})).subscribe()}ngAfterViewInit(){this.waitForPaginatorLoad().then(()=>{this._sort&&this._paginator&&(this._sort.sort({id:"name",start:"desc",disableClear:!0}),this._changeDetectorRef.markForCheck(),this._sort.sortChange.pipe((0,m.R)(this._unsubscribeAll)).subscribe(()=>{this._paginator.pageIndex=0}),(0,B.T)(this._sort.sortChange,this._paginator.page).pipe((0,A.w)(()=>(this.isLoading=!0,this._roleService.findAllRoles(this._paginator.pageIndex,this._paginator.pageSize,this._sort.active,this._sort.direction))),(0,I.U)(()=>{this.isLoading=!1})).subscribe())})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}updateRoleStatus(t,o,i){this.isLoading=!0,this.selectedSlide=i,this._roleService.updateRoleStatus({id:o.id,active:t.checked}).pipe((0,m.R)(this._unsubscribeAll)).subscribe(a=>{a&&(this._snackBar.openFromComponent(x.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:a.message,title:"Confirmaci\xf3n",type:"success",svgIcon:"mat_solid:done"}}),this.isLoading=!1,this.selectedSlide=-1,this._changeDetectorRef.markForCheck())})}deleteRole(t){this._fuseConfirmationService.open({title:"Eliminar rol",message:`\xbfEst\xe1 seguro que desea eliminar el m\xf3dulo ${t.name}? Perder\xe1 el acceso a todos los datos asociados al mismo.`,icon:{show:!0,name:"heroicons_outline:question-mark-circle",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._roleService.removeRole(t.id,this.currentMerchant.id,this.pagination.page,this.pagination.size,"name","desc").pipe((0,m.R)(this._unsubscribeAll)).subscribe(({data:a})=>{a&&this._snackBar.openFromComponent(x.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:a.paginatedRemoveRole.message,title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"heroicons_solid:check"}}),this._changeDetectorRef.markForCheck()})})}trackByFn(t,o){return t||o.id}waitForPaginatorLoad(){var t=this;return(0,L.Z)(function*(){for(;!t._paginator||void 0===t._paginator;)yield new Promise(o=>{setTimeout(o,200)});return t._paginator})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.sBO),e.Y36(Q.R),e.Y36(F.N),e.Y36(U.ux),e.Y36(D.yh))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ath-roles"]],viewQuery:function(t,o){if(1&t&&(e.Gf(T.NW,5),e.Gf(C.YE,5)),2&t){let i;e.iGM(i=e.CRH())&&(o._paginator=i.first),e.iGM(i=e.CRH())&&(o._sort=i.first)}},decls:28,vars:11,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","flex-auto","min-w-0","overflow-x-auto","overflow-y-auto","bg-card","dark:bg-transparent","lg:overflow-x-hidden"],[1,"relative","flex","flex-col","px-6","py-8","border-b","sm:flex-row","flex-0","sm:items-center","sm:justify-between","md:px-8"],[1,"flex-1","min-w-0"],[1,"flex-wrap","items-center","hidden","font-medium","sm:flex"],[1,"whitespace-nowrap","text-primary-500",3,"routerLink"],[1,"flex","items-center","ml-1","whitespace-nowrap"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1","text-primary-500"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"ml-1"],[1,"mt-2"],[1,"mt-2","text-2xl","font-extrabold","leading-tight","tracking-tight"],["class","flex flex-wrap items-center mt-2 sm:mt-0 shrink-0 sm:ml-4",4,"ngxPermissionsOnly"],[1,"flex","flex-col","flex-auto"],[1,"flex","flex-col","justify-between","flex-auto"],[4,"ngIf"],[4,"ngxPermissionsOnly"],["noRoles",""],[1,"flex","flex-wrap","items-center","mt-2","sm:mt-0","shrink-0","sm:ml-4"],[1,"mt-4","mr-4","sm:mt-0","fuse-mat-dense","fuse-mat-no-subscript","fuse-mat-rounded","min-w-64"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","",3,"formControl","autocomplete","placeholder"],["mat-raised-button","",1,"mt-4","text-white","sm:mt-0","bg-gradient-to-r","from-primary-500","to-primary-600","hover:to-primary-900","hover:shadow-lg",3,"routerLink"],[3,"svgIcon"],[1,"hidden","ml-2","mr-1","text-white","sm:block"],[4,"ngIf","ngIfElse"],[1,"grid"],["matSort","","matSortDisableClear","",1,"sticky","top-0","z-10","grid","gap-4","px-6","py-4","font-semibold","shadow","roles-table","md:px-8","text-md","text-secondary","bg-gray-50","dark:bg-black","dark:bg-opacity-5"],[1,"hidden","sm:block",3,"mat-sort-header"],[4,"ngxPermissionsExcept"],["class","flex items-center justify-center",3,"mat-sort-header",4,"ngxPermissionsOnly"],[1,"pr-6","text-right"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-center","justify-center",3,"mat-sort-header"],[1,"grid","items-center","gap-4","px-6","py-3","border-b","roles-table","md:px-8"],[1,"flex","truncate"],["svgIcon","heroicons_solid:fire","class","mr-1",3,"color",4,"ngIf"],[1,"truncate"],["class","flex justify-center mr-4 text-center",4,"ngxPermissionsOnly"],["svgIcon","heroicons_solid:fire",1,"mr-1",3,"color"],[1,"flex","justify-center","mr-4","text-center"],[3,"checked","color","change"],[3,"diameter","color"],[1,"flex","flex-row","justify-end","gap-2"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"routerLink"],[1,"icon-size-5",3,"svgIcon"],["mat-stroked-button","",1,"px-2","leading-6","min-w-10","min-h-7","h-7",3,"click"],["class","z-10 border-b sm:inset-x-0 sm:bottom-0 sm:border-t sm:border-b-0 bg-gray-50 dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons",4,"ngIf"],[1,"z-10","border-b","sm:inset-x-0","sm:bottom-0","sm:border-t","sm:border-b-0","bg-gray-50","dark:bg-transparent",3,"ngClass","length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons"],[1,"p-8","text-4xl","font-semibold","tracking-tight","text-center","border-t","sm:p-16"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div")(6,"a",4),e._uU(7,"Inicio"),e.qZA()(),e.TgZ(8,"div",5),e._UZ(9,"mat-icon",6),e.TgZ(10,"a",7),e._uU(11,"Roles"),e.qZA()()(),e.TgZ(12,"div",8)(13,"a",9),e._UZ(14,"mat-icon",6),e.TgZ(15,"span",10),e._uU(16,"Regresar"),e.qZA()()()(),e.TgZ(17,"div",11)(18,"div",12),e._uU(19," Gesti\xf3n de Roles "),e.qZA()()(),e.YNc(20,V,8,7,"div",13),e.qZA(),e.TgZ(21,"div",14)(22,"div",15),e.YNc(23,de,2,2,"ng-container",16),e.ALo(24,"async"),e.YNc(25,fe,2,1,"ng-container",17),e.YNc(26,he,2,0,"ng-template",null,18,e.W1O),e.qZA()()()),2&t&&(e.xp6(6),e.Q6J("routerLink","/desktop"),e.xp6(3),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(4),e.Q6J("routerLink","./.."),e.xp6(1),e.Q6J("svgIcon","mat_solid:chevron_left"),e.xp6(6),e.Q6J("ngxPermissionsOnly",e.DdM(9,h)),e.xp6(3),e.Q6J("ngIf",e.lcZ(24,7,o.roles$)),e.xp6(2),e.Q6J("ngxPermissionsOnly",e.DdM(10,h)))},dependencies:[f.rH,f.yS,g.mk,g.sg,g.O5,l.Fj,l.JJ,l.oH,N.PQ,M.lW,P.Hw,u.KE,u.qo,Y.Nt,T.NW,G.Ou,H.Rr,C.YE,C.nU,K.gE,g.Ov],encapsulation:2,data:{animation:E.L},changeDetection:0}),n})();var xe=r(68675),ve=r(18505),be=r(54787),Ce=r(77446),v=r(80288),Re=r(87238);function Ze(n,s){1&n&&(e.TgZ(0,"a",43),e._uU(1,"Nuevo"),e.qZA())}function we(n,s){if(1&n&&(e.TgZ(0,"a",43),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Oqu(t.selectedRole.name)}}function Te(n,s){1&n&&(e.TgZ(0,"div",44),e._uU(1," Nuevo Rol "),e.qZA())}function ye(n,s){if(1&n&&(e.TgZ(0,"div",44),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" Informaci\xf3n de ",t.selectedRole.name," ")}}const b=function(n){return{"cursor-not-allowed":n}};function ke(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",45),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.createRole())}),e._UZ(1,"mat-icon",46),e.TgZ(2,"span",47),e._uU(3,"Guardar"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.roleForm.invalid)("ngClass",e.VKq(3,b,t.roleForm.invalid)),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:save")}}function Ae(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",45),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.updateRole())}),e._UZ(1,"mat-icon",46),e.TgZ(2,"span",47),e._uU(3,"Actualizar"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.roleForm.invalid)("ngClass",e.VKq(3,b,t.roleForm.invalid)),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:refresh")}}function Ie(n,s){1&n&&(e.TgZ(0,"mat-error"),e._uU(1," El nombre del rol es obligatorio. "),e.qZA())}function Je(n,s){1&n&&(e.TgZ(0,"mat-error"),e._uU(1," El nombre rol debe contener entre 3 y 255 caracteres. "),e.qZA())}function Qe(n,s){1&n&&(e.TgZ(0,"span"),e._uU(1,"Leer"),e.qZA())}function Fe(n,s){if(1&n&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.name)}}function Ue(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"li")(1,"mat-checkbox",56),e.NdJ("ngModelChange",function(i){const c=e.CHM(t).$implicit;return e.KtG(c.checked=i)})("ngModelChange",function(){e.CHM(t);const i=e.oxw().index,a=e.oxw();return e.KtG(a.updateAsComplete(i))}),e.YNc(2,Qe,2,0,"span",27),e.YNc(3,Fe,2,1,"span",27),e.qZA()()}if(2&n){const t=s.$implicit,o=e.oxw(),i=o.index,a=o.$implicit,c=e.MAs(3),d=e.oxw();e.xp6(1),e.Q6J("ngModel",t.checked)("disabled",(c.indeterminate&&d.someCompleteExceptRead(i)||a.checked)&&t.id===t.parentId),e.xp6(1),e.Q6J("ngIf",t.id===t.parentId),e.xp6(1),e.Q6J("ngIf",t.id!==t.parentId)}}function De(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"section",48)(1,"span",49)(2,"mat-checkbox",50,51),e.NdJ("change",function(i){const c=e.CHM(t).index,d=e.oxw();return e.KtG(d.setAll(i.checked,c))}),e.TgZ(4,"span",52),e._uU(5),e.qZA()()(),e.TgZ(6,"span",53)(7,"ul",54),e.YNc(8,Ue,4,4,"li",55),e.qZA()()()}if(2&n){const t=s.$implicit,o=s.index,i=e.oxw();e.xp6(1),e.Q6J("matTooltip",t.name),e.xp6(1),e.Q6J("checked",t.checked)("indeterminate",i.someComplete(o)),e.xp6(3),e.hij(" ",t.name,""),e.xp6(3),e.Q6J("ngForOf",t.permissions)}}function Ne(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",45),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.createRole())}),e._UZ(1,"mat-icon",46),e.TgZ(2,"span",47),e._uU(3,"Guardar"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.roleForm.invalid)("ngClass",e.VKq(3,b,t.roleForm.invalid)),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:save")}}function Me(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",45),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.updateRole())}),e._UZ(1,"mat-icon",46),e.TgZ(2,"span",47),e._uU(3,"Actualizar"),e.qZA()()}if(2&n){const t=e.oxw();e.Q6J("disabled",t.roleForm.invalid)("ngClass",e.VKq(3,b,t.roleForm.invalid)),e.xp6(1),e.Q6J("svgIcon","heroicons_outline:refresh")}}const Ye=[{path:"",component:_e,resolve:{roles:w.RW}},{path:":roleId",component:(()=>{class n{constructor(t,o,i,a,c,d,_,p){this._activatedRoute=t,this._changeDetectorRef=o,this._formBuilder=i,this._fuseConfirmationService=a,this._router=c,this._snackBar=d,this._roleService=_,this.store=p,this.searchInputControl=new l.NI(null),this.windowsMode="new",this._unsubscribeAll=new y.x}ngOnInit(){this.store.select(be.rk).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.authUser=t}),this.store.select(J.oM).pipe((0,m.R)(this._unsubscribeAll)).subscribe(t=>{this.selectedRole=t}),this.roleForm=this._formBuilder.group({id:[""],name:["",[l.kI.required,l.kI.minLength(3),l.kI.maxLength(255)]],description:["",[l.kI.maxLength(1e3)]]}),this._activatedRoute.params.pipe((0,m.R)(this._unsubscribeAll)).subscribe(({roleId:t})=>{"new"!==t&&(this.windowsMode="edit"),this._fillRoleData()}),this.searchInputControl.valueChanges.pipe((0,m.R)(this._unsubscribeAll),(0,k.b)(100),(0,xe.O)(null),(0,ve.b)(t=>{this.filteredPermissions=null!==t?this.permissions.filter(o=>o.name.toLowerCase().includes(t.toLowerCase())):this.permissions,this._changeDetectorRef.markForCheck()})).subscribe()}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}createRole(){const t=this.buildRole();delete t.id,this._fuseConfirmationService.open({title:"Crear Rol",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"heroicons_outline:question-mark-circle",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._roleService.createRole(t).pipe((0,m.R)(this._unsubscribeAll)).subscribe(a=>{a&&(this._snackBar.openFromComponent(x.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:a.message,title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"heroicons_solid:check"}}),this._router.navigateByUrl("/modules/settings/roles"))},a=>{console.log(a)})})}updateRole(){const t=this.buildRole();this._fuseConfirmationService.open({title:"Actualizar Rol",message:"\xbfEsta seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"heroicons_outline:question-mark-circle",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(i=>{"confirmed"===i&&this._roleService.updateRole(t).pipe((0,m.R)(this._unsubscribeAll)).subscribe(a=>{a&&(this._snackBar.openFromComponent(x.h,{panelClass:["p-0","bg-transparent"],horizontalPosition:"end",verticalPosition:"bottom",duration:5e3,data:{message:a.message,title:"Confirmaci\xf3n",type:"success",appearance:"fill",svgIcon:"heroicons_solid:check"}}),this._router.navigateByUrl("/modules/settings/roles"))},a=>{console.log(a)})})}updateAsComplete(t){if(this.filteredPermissions[t].checked=null!=this.filteredPermissions[t].permissions&&this.filteredPermissions[t].permissions.every(o=>o.checked),this.someComplete(t)){const o=this.filteredPermissions[t].permissions.findIndex(i=>i.id===i.parentId);-1!==o&&(this.filteredPermissions[t].permissions[o].checked=!0)}}someComplete(t){return null!=this.filteredPermissions[t].permissions&&this.filteredPermissions[t].permissions.filter(o=>o.checked).length>0&&!this.filteredPermissions[t].checked}someCompleteExceptRead(t){return null!=this.filteredPermissions[t].permissions&&this.filteredPermissions[t].permissions.filter(o=>o.checked&&o.id!==o.parentId).length>0&&!this.filteredPermissions[t].checked}setAll(t,o){this.filteredPermissions[o].checked=t,null!=this.filteredPermissions[o].permissions&&this.filteredPermissions[o].permissions.forEach(i=>i.checked=t)}trackByFn(t,o){return o.id||t}_fillRoleData(){"new"!==this.windowsMode&&this.roleForm.patchValue(this.selectedRole),this._setRolePermissionsData(),this._changeDetectorRef.markForCheck()}_setRolePermissionsData(){const t=this.authUser.role.permissions.filter(o=>o.id===o.parentId).reduce((o,{id:i,parentId:a,name:c})=>{if(!o.some(d=>d.parentId===a)){let d=this.selectedRole.permissionsId;"new"===this.windowsMode&&(d=[]);const _=this.authUser.role.permissions.filter(p=>p.parentId===a).map(p=>Object.assign(Object.assign({},p),{checked:d.some(R=>R===p.id)})).sort((p,R)=>p.id-R.id);o.push({id:i,parentId:a,name:c,checked:_.every(p=>p.checked),permissions:_})}return o},[]);this.permissions=t}buildRole(){const t=this.roleForm.getRawValue();let o=[];return this.filteredPermissions.forEach(i=>{o=o.concat(i.permissions)}),t.permissionsId=o.filter(i=>i.checked).map(i=>i.id),t}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(f.gz),e.Y36(e.sBO),e.Y36(l.qu),e.Y36(Q.R),e.Y36(f.F0),e.Y36(U.ux),e.Y36(F.N),e.Y36(D.yh))},n.\u0275cmp=e.Xpm({type:n,selectors:[["role-detail"]],decls:69,vars:40,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-y-auto"],[1,"flex","flex-col","flex-wrap","p-6","sm:flex-row","flex-0","sm:items-center","sm:justify-between","sm:pt-12","sm:px-10","bg-default","dark:bg-transparent"],[1,"flex-1","min-w-0"],[1,"flex-wrap","items-center","hidden","font-medium","sm:flex"],[1,"flex","items-center","ml-1","whitespace-nowrap"],["routerLink","/desktop",1,"ml-1","text-primary-500","hover:underline"],[1,"icon-size-5","text-secondary",3,"svgIcon"],["routerLink","/modules/settings/roles",1,"ml-1","text-primary-500","hover:underline"],["class","ml-1 text-primary-500",4,"ngIf"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"ml-1"],[1,"mt-2"],["class","mt-2 text-3xl font-extrabold leading-tight tracking-tight sm:text-3xl",4,"ngIf"],[1,"flex","items-center","flex-shrink-0","mt-6","sm:mt-0","sm:ml-4"],["class","ml-4 text-white bg-primary-500 hover:bg-primary-700 hover:shadow-lg","mat-raised-button","",3,"disabled","ngClass","click",4,"ngIf"],[1,"flex-auto","p-4","sm:p-6"],[1,"flex","flex-col","flex-auto","min-w-0"],["multi","",1,"w-full","bg-transparent"],[2,"border-top-left-radius","0.5rem !important","border-top-right-radius","0.5rem !important",3,"expanded"],[3,"collapsedHeight"],[1,"flex","items-center"],[1,"text-2xl","font-extrabold","leading-tight","tracking-tight","sm:text-2xl"],[1,"grid","w-full","px-2","py-6","border-t-2","sm:py-8","sm:px-4","gap-y-3","gap-x-6","sm:grid-cols-3",3,"formGroup","autocomplete"],[1,"w-full","sm:col-span-1"],["matPrefix","",1,"hidden","sm:flex","icon-size-5",3,"svgIcon"],["matInput","","required","",3,"type","formControlName","minlength","maxlength","placeholder"],[4,"ngIf"],[1,"w-full","sm:col-span-2","fuse-mat-textarea"],["matInput","","matTextareaAutosize","","matTextareaAutosize","",3,"formControlName","rows","spellcheck","maxlength"],["desc",""],[1,"text-right"],["mPermissionPanel",""],[1,"flex","items-center","justify-evenly"],[1,"hidden","text-2xl","font-extrabold","leading-tight","tracking-tight","sm:block","sm:text-2xl"],[1,"sm:ml-10","fuse-mat-dense","fuse-mat-bold","fuse-mat-no-subscript","fuse-mat-rounded","min-w-50",3,"click"],["matPrefix","",1,"icon-size-5",3,"svgIcon"],["matInput","","placeholder","Buscar subm\xf3dulos",3,"formControl","autocomplete"],[1,"w-full","py-6","border-t-2","sm:py-10","sm:px-4"],[1,"flex","flex-wrap","justify-start","gap-y-1","gap-x-1","sm:gap-4"],["class","sm:py-6 sm:px-5 py-4 px-3 w-[49%] sm:w-50 shadow-sm truncate light dark:dark rounded-md",4,"ngFor","ngForOf"],[1,"flex","flex-col","flex-wrap","justify-end","px-6","pb-10","sm:flex-row","flex-0","sm:items-center","sm:px-10","bg-default","dark:bg-transparent"],[1,"flex","items-center","flex-shrink-0","mt-6","text-right","sm:mt-0","sm:ml-4"],[1,"ml-1","text-primary-500"],[1,"mt-2","text-3xl","font-extrabold","leading-tight","tracking-tight","sm:text-3xl"],["mat-raised-button","",1,"ml-4","text-white","bg-primary-500","hover:bg-primary-700","hover:shadow-lg",3,"disabled","ngClass","click"],[3,"svgIcon"],[1,"ml-2","mr-1"],[1,"sm:py-6","sm:px-5","py-4","px-3","w-[49%]","sm:w-50","shadow-sm","truncate","light","dark:dark","rounded-md"],[1,"block","w-full","truncate",3,"matTooltip"],[1,"sm:mx-3",3,"checked","indeterminate","change"],["checkP",""],[1,"font-bold","sm:line-clamp-1"],[1,""],[1,"mt-3","ml-4","space-y-2","list-none","sm:ml-8"],[4,"ngFor","ngForOf"],["color","primary",3,"ngModel","disabled","ngModelChange"]],template:function(t,o){if(1&t){const i=e.EpF();e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div",4)(6,"a",5),e._uU(7,"Inicio"),e.qZA()(),e.TgZ(8,"div",4),e._UZ(9,"mat-icon",6),e.TgZ(10,"a",7),e._uU(11,"Roles"),e.qZA()(),e.TgZ(12,"div",4),e._UZ(13,"mat-icon",6),e.YNc(14,Ze,2,0,"a",8),e.YNc(15,we,2,1,"a",8),e.qZA()(),e.TgZ(16,"div",9)(17,"a",10),e._UZ(18,"mat-icon",6),e.TgZ(19,"span",11),e._uU(20,"Regresar"),e.qZA()()()(),e.TgZ(21,"div",12),e.YNc(22,Te,2,0,"div",13),e.YNc(23,ye,2,1,"div",13),e.qZA()(),e.TgZ(24,"div",14),e.YNc(25,ke,4,5,"button",15),e.YNc(26,Ae,4,5,"button",15),e.qZA()(),e.TgZ(27,"div",16)(28,"div",17)(29,"mat-accordion",18)(30,"mat-expansion-panel",19)(31,"mat-expansion-panel-header",20)(32,"mat-panel-title",21)(33,"div",22),e._uU(34," Informaci\xf3n General "),e.qZA()()(),e.TgZ(35,"form",23)(36,"mat-form-field",24)(37,"mat-label"),e._uU(38,"Nombre"),e.qZA(),e._UZ(39,"mat-icon",25)(40,"input",26),e.YNc(41,Ie,2,0,"mat-error",27),e.YNc(42,Je,2,0,"mat-error",27),e.qZA(),e.TgZ(43,"mat-form-field",28)(44,"mat-label"),e._uU(45,"Descripci\xf3n"),e.qZA(),e._UZ(46,"mat-icon",25)(47,"textarea",29,30),e.TgZ(49,"mat-hint",31),e._uU(50),e.qZA()()()(),e.TgZ(51,"mat-expansion-panel",19,32)(53,"mat-expansion-panel-header",20)(54,"mat-panel-title",21)(55,"div",22)(56,"div",33)(57,"div",34),e._uU(58," Subm\xf3dulos y Permisos "),e.qZA(),e.TgZ(59,"mat-form-field",35),e.NdJ("click",function(){e.CHM(i);const c=e.MAs(52);return e.KtG(c.expanded=!1)}),e._UZ(60,"mat-icon",36)(61,"input",37),e.qZA()()()()(),e.TgZ(62,"div",38)(63,"div",39),e.YNc(64,De,9,5,"section",40),e.qZA()()()()()(),e.TgZ(65,"div",41)(66,"div",42),e.YNc(67,Ne,4,5,"button",15),e.YNc(68,Me,4,5,"button",15),e.qZA()()()}if(2&t){const i=e.MAs(48);e.xp6(9),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(4),e.Q6J("svgIcon","mat_solid:chevron_right"),e.xp6(1),e.Q6J("ngIf","edit"!==o.windowsMode),e.xp6(1),e.Q6J("ngIf","edit"===o.windowsMode),e.xp6(2),e.Q6J("routerLink","./.."),e.xp6(1),e.Q6J("svgIcon","mat_solid:chevron_left"),e.xp6(4),e.Q6J("ngIf","edit"!==o.windowsMode),e.xp6(1),e.Q6J("ngIf","edit"===o.windowsMode),e.xp6(2),e.Q6J("ngIf","new"===o.windowsMode),e.xp6(1),e.Q6J("ngIf","new"!==o.windowsMode),e.xp6(4),e.Udp("border-bottom-left-radius","new"!==o.windowsMode?"0.5rem !important":""),e.Q6J("expanded",!0),e.xp6(1),e.Q6J("collapsedHeight","56px"),e.xp6(4),e.Q6J("formGroup",o.roleForm)("autocomplete","off"),e.xp6(4),e.Q6J("svgIcon","heroicons_solid:pencil-alt"),e.xp6(1),e.Q6J("type","text")("formControlName","name")("minlength",3)("maxlength",255)("placeholder","Nombre del rol"),e.xp6(1),e.Q6J("ngIf",o.roleForm.get("name").hasError("required")),e.xp6(1),e.Q6J("ngIf",o.roleForm.get("name").hasError("maxlength")||o.roleForm.get("name").hasError("minlength")),e.xp6(4),e.Q6J("svgIcon","heroicons_solid:menu-alt-2"),e.xp6(1),e.Q6J("formControlName","description")("rows",3)("spellcheck",!1)("maxlength",1e3),e.xp6(3),e.hij("Total de caracteres ",i.value.length," / 1000"),e.xp6(1),e.Udp("border-bottom-left-radius","new"!==o.windowsMode?"0.5rem !important":""),e.Q6J("expanded",!0),e.xp6(2),e.Q6J("collapsedHeight","56px"),e.xp6(7),e.Q6J("svgIcon","heroicons_solid:search"),e.xp6(1),e.Q6J("formControl",o.searchInputControl)("autocomplete","off"),e.xp6(3),e.Q6J("ngForOf",o.filteredPermissions),e.xp6(3),e.Q6J("ngIf","new"===o.windowsMode),e.xp6(1),e.Q6J("ngIf","new"!==o.windowsMode)}},dependencies:[f.yS,g.mk,g.sg,g.O5,l._Y,l.Fj,l.JJ,l.JL,l.Q7,l.wO,l.nD,l.On,l.oH,l.sg,l.u,N.PQ,M.lW,Ce.oG,v.pp,v.ib,v.yz,v.yK,P.Hw,u.TO,u.KE,u.bx,u.hX,u.qo,Y.Nt,Re.gM],encapsulation:2,changeDetection:0}),n})(),resolve:{role:w.NB}}];let Se=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[f.Bz.forChild(Ye),S.m]}),n})()}}]);