"use strict";(self.webpackChunkatherp=self.webpackChunkatherp||[]).push([[428],{80428:(qt,F,s)=>{s.r(F),s.d(F,{ChartOfAccountModule:()=>It});var y=s(91079),h=s(90149),C=s(35357),K=s(17460),L=s(20449),H=s(28258),U=s(39646),w=s(77579),p=s(82722),I=s(22594);class O{}class P{}class q{static emptyAccount(){return{_id:null,ownerAccount:"root",name:"root",number:0,isGroup:!1,accountType:"",currency:A.CUP,level:-1,balance_must_be:"",merchantId:""}}}var A=(()=>{return(n=A||(A={})).MLC="MLC",n.CUP="CUP",n.USD="USD",A;var n})();const V=["MLC","CUP","USD","EUR","BTC"],j=["Debe","Haber"],z=["Banco","Cuenta Corriente","Cuenta de Ahorro","Cuenta de Inversi\xf3n"];var m=s(93075),x=s(48966),W=s(17489),X=s(78372),tt=s(68675),v=s(63900),t=s(5e3),D=s(61135),N=s(95698),b=s(54004),et=s(92340),ot=s(40520);const T=et.N.API_URL;let Z=(()=>{class n{constructor(e){this._httpClient=e,this.dataChange=new D.X([]),this._accounts=new D.X([])}get data(){return this.dataChange.value}get data$(){return this.dataChange.asObservable()}get accounts$(){return this._accounts.asObservable()}createAccount(e){return this.data$.pipe((0,N.q)(1),(0,v.w)(o=>this._httpClient.post(`${T}/accounts`,e).pipe((0,b.U)(c=>{let r=!0;for(const i of o)if(this.addChildren(i,c.account)){r=!1;break}return r&&(c.account.level=0,c.account.ownerAccount="root",o.push({item:c.account,children:[]}),this.sortBrothers({item:c.account,children:o},c.account)),this._accounts.next([c.account,...this._accounts.value]),this.dataChange.next(o),c}))))}updateAccount(e){return this.data$.pipe((0,N.q)(1),(0,v.w)(o=>this._httpClient.patch(`${T}/accounts/${e._id}`,e).pipe((0,b.U)(c=>{for(const u of o){if(u.item._id===c.account._id){o.splice(o.indexOf(u),1);break}if(this.removeChildren(u,c.account))break}let r=!0;for(const u of o)if(this.addChildren(u,c.account)){r=!1;break}r&&(c.account.level=0,c.account.ownerAccount="root",o.push({item:c.account,children:[]}),this.sortBrothers({item:c.account,children:o},c.account));const i=[];return this.getAccountsFromTree({item:null,children:[...o]},i),this._accounts.next(i),this.dataChange.next(o),c}))))}deleteAccount(e){return this.data$.pipe((0,N.q)(1),(0,v.w)(o=>this._httpClient.delete(`${T}/accounts/${e}`).pipe((0,b.U)(c=>{for(const i of o){if(i.item._id===c.account._id){o.splice(o.indexOf(i),1);break}if(this.removeChildren(i,c.account))break}const r=[];return this.getAccountsFromTree({item:null,children:[...o]},r),this._accounts.next(r),this.dataChange.next(o),c}))))}getAccountsByMerchant(e){return this._httpClient.get(`${T}/accounts/all-by-business/${e}`).pipe((0,b.U)(o=>{const c=this.buildAccountTree(o.accounts,"",0);return this.dataChange.next(c),this._accounts.next(o.accounts),o.accounts}))}addChildren(e,o){if(e.item._id===o.ownerAccount){const c=new O;return c.item=o,c.children=[],e.children.push(c),this.sortBrothers(e,o),!0}for(const c of e.children)if(this.addChildren(c,o))return!0;return!1}updateChildren(e,o){if(e.item._id===o._id)return e.item.isGroup!==o.isGroup&&(e.children=[]),e.item=o,!0;for(const c of e.children)if(this.updateChildren(c,o))return!0;return!1}removeChildren(e,o){for(let c=0;c<e.children.length;c++){const r=e.children[c];if(r.item._id===o._id)return e.children.splice(c,1),!0;if(this.removeChildren(r,o))return!0}return!1}getAccountsFromTree(e,o){e.item&&o.push(e.item);for(const c of e.children)this.getAccountsFromTree(c,o)}sortBrothers(e,o){for(let c=0;c<e.children.length;c++){const r=e.children[c];if(r.item._id===o._id&&(e.children=e.children.sort((i,u)=>Number(u.item.isGroup)-Number(i.item.isGroup))),this.sortBrothers(r,o))return!0}return!1}buildAccountTree(e,o,c){const r=e.filter(0===c?u=>0===u.level:u=>u.ownerAccount===o),i=[];for(const u of r){const l=new O;l.item=u,l.children=[],this.getAllChildrenNodes(e,u._id,l),i.push(l)}return i.sort((u,l)=>Number(l.item.isGroup)-Number(u.item.isGroup)),i}getAllChildrenNodes(e,o,c){const r=[],i=e.filter(u=>o===u.ownerAccount);for(const u of i){const l=new O;l.item=u,l.children=[],this.getAllChildrenNodes(e,u._id,l),r.push(l),c.children=r}}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(ot.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var M=s(71683),k=s(85094),d=s(69808),Q=s(90508),$=s(47423),nt=s(77446),g=s(67322),G=s(98833),E=s(74107);function ct(n,a){1&n&&(t.TgZ(0,"h2",6),t._uU(1,"Agregar cuenta"),t.qZA())}function rt(n,a){1&n&&(t.TgZ(0,"h2",6),t._uU(1,"Editar cuenta"),t.qZA())}function it(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," El nombre de la cuenta es obligatorio. "),t.qZA())}function at(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," El n\xfamero de la cuenta es obligatorio}. "),t.qZA())}function st(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," La cueta padre es obligatoria. "),t.qZA())}function lt(n,a){if(1&n&&(t.TgZ(0,"mat-option",24),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.AsE(" ",e.name,"","root"!==e.name?" - "+e.number:""," ")}}function ut(n,a){if(1&n&&(t.TgZ(0,"mat-option",24),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function mt(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," El tipo de cuenta es obligatorio. "),t.qZA())}function dt(n,a){if(1&n&&(t.TgZ(0,"mat-option",24),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function ht(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," La moneda es obligatoria. "),t.qZA())}function pt(n,a){if(1&n&&(t.TgZ(0,"mat-option",24),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function ft(n,a){1&n&&(t.TgZ(0,"mat-error"),t._uU(1," Este campo es obligatorio. "),t.qZA())}function _t(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",7)(1,"div",8)(2,"form",9)(3,"div",10)(4,"div",11)(5,"mat-form-field",12)(6,"mat-label"),t._uU(7,"Nombre de la cuenta"),t.qZA(),t._UZ(8,"input",13),t.YNc(9,it,2,0,"mat-error",5),t.qZA()(),t.TgZ(10,"div",11)(11,"mat-form-field",12)(12,"mat-label"),t._uU(13,"N\xfamero de la cuenta"),t.qZA(),t._UZ(14,"input",14),t.TgZ(15,"mat-hint"),t._uU(16,"N\xfamero de la cuenta. Este ser\xe1 incluido como prefijo en el nombre de la cuenta "),t.qZA(),t.YNc(17,at,2,0,"mat-error",5),t.qZA()(),t.TgZ(18,"div",15)(19,"mat-checkbox",16,17),t._uU(21,"Es Grupo "),t.qZA()(),t.TgZ(22,"div",11)(23,"mat-form-field",12)(24,"mat-label"),t._uU(25,"Cuenta Padre"),t.qZA(),t._UZ(26,"input",18),t.YNc(27,st,2,0,"mat-error",5),t.TgZ(28,"mat-autocomplete",19,20),t.NdJ("optionSelected",function(c){t.CHM(e);const r=t.oxw();return t.KtG(r.fillOwnerAccounts(c))}),t.YNc(30,lt,2,3,"mat-option",21),t.ALo(31,"async"),t.qZA()()(),t.TgZ(32,"div",11)(33,"mat-form-field",12)(34,"mat-label"),t._uU(35,"Tipo de cuenta"),t.qZA(),t.TgZ(36,"mat-select",22),t.YNc(37,ut,2,2,"mat-option",21),t.qZA(),t.YNc(38,mt,2,0,"mat-error",5),t.qZA()(),t.TgZ(39,"div",11)(40,"mat-form-field",12)(41,"mat-label"),t._uU(42,"Moneda"),t.qZA(),t.TgZ(43,"mat-select",22),t.YNc(44,dt,2,2,"mat-option",21),t.qZA(),t.YNc(45,ht,2,0,"mat-error",5),t.qZA()(),t.TgZ(46,"div",11)(47,"mat-form-field",12)(48,"mat-label"),t._uU(49,"Balance debe ser"),t.qZA(),t.TgZ(50,"mat-select",23),t.YNc(51,pt,2,2,"mat-option",21),t.qZA(),t.YNc(52,ft,2,0,"mat-error",5),t.qZA()()()()()()}if(2&n){const e=t.MAs(29),o=t.oxw();t.xp6(2),t.Q6J("formGroup",o.accountForm)("autocomplete","off"),t.xp6(6),t.Q6J("formControlName","name")("type","text")("placeholder","Introduzca el nombre de la cuenta"),t.xp6(1),t.Q6J("ngIf",o.accountForm.get("name").hasError("required")),t.xp6(5),t.Q6J("formControlName","number")("placeholder","Introduzca el n\xfamero de la cuenta")("min",1),t.xp6(3),t.Q6J("ngIf",o.accountForm.get("number").hasError("required")),t.xp6(2),t.Q6J("formControlName","isGroup"),t.xp6(7),t.Q6J("type","text")("placeholder","Filtre por nombre o n\xfamero de cuenta")("formControl",o.searchAccountsControl)("matAutocomplete",e),t.xp6(1),t.Q6J("ngIf",o.accountForm.get("ownerAccount").hasError("required")),t.xp6(3),t.Q6J("ngForOf",t.lcZ(31,28,o.filteredAccounts)),t.xp6(6),t.Q6J("formControlName","accountType")("placeholder","Seleccione un tipo de cuenta"),t.xp6(1),t.Q6J("ngForOf",o.accountTypes),t.xp6(1),t.Q6J("ngIf",o.accountForm.get("accountType").hasError("required")),t.xp6(5),t.Q6J("formControlName","currency")("placeholder","Seleccione una moneda"),t.xp6(1),t.Q6J("ngForOf",o.currencies),t.xp6(1),t.Q6J("ngIf",o.accountForm.get("currency").hasError("required")),t.xp6(5),t.Q6J("formControlName","balance_must_be"),t.xp6(1),t.Q6J("ngForOf",o.balanceMustBeArr),t.xp6(1),t.Q6J("ngIf",o.accountForm.get("balance_must_be").hasError("required"))}}const Y=function(n){return{"cursor-not-allowed":n}};function gt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(e);const c=t.oxw(2);return t.KtG(c.updateAccount())}),t._uU(1,"Actualizar"),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("ngClass",t.VKq(2,Y,e.accountForm.invalid))("disabled",e.accountForm.invalid)}}function Ct(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"button",28),t.NdJ("click",function(){t.CHM(e);const c=t.oxw(2);return t.KtG(c.createAccount())}),t._uU(1,"Agregar"),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("ngClass",t.VKq(2,Y,e.accountForm.invalid))("disabled",e.accountForm.invalid)}}function At(n,a){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",25)(2,"button",26),t.NdJ("click",function(){t.CHM(e);const c=t.oxw();return t.KtG(c.closeDialog())}),t._uU(3,"Cancelar"),t.qZA(),t.YNc(4,gt,2,4,"button",27),t.YNc(5,Ct,2,4,"button",27),t.qZA(),t.BQk()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("color","warn"),t.xp6(2),t.Q6J("ngIf","edit"===e.data.dialogMode),t.xp6(1),t.Q6J("ngIf","add"===e.data.dialogMode)}}let xt=(()=>{class n{constructor(e,o,c,r,i,u,l){this.data=e,this._accountsService=o,this._changeDetectorRef=c,this._dialogRef=r,this._formBuilder=i,this._athConfirmationService=u,this.store=l,this.accountTypes=z,this.currencies=V,this.balanceMustBeArr=j,this.accounts=[],this._unsubscribeAll=new w.x,this.dialogMode=e.dialogMode,this.account=Object.assign({},this.data.account)}ngOnInit(){if(this._accountsService.accounts$.pipe((0,p.R)(this._unsubscribeAll)).subscribe(e=>{this.accounts=e,this.accounts.push(q.emptyAccount())}),this.searchAccountsControl=new m.p4(""),this.accountForm=this._formBuilder.group({_id:[null],name:[null,[m.kI.required,m.kI.maxLength(250)]],number:[0,[m.kI.required,m.kI.min(0)]],isGroup:[!1],ownerAccount:[null],accountType:[null],currency:[null,[m.kI.required]],balance_must_be:[null],level:[0],merchantId:[this.data.merchant.id],active:[!0]}),"edit"===this.dialogMode){this.accountForm.patchValue(this.account),this.accountForm.get("level").setValue(this.account?this.account.level:0);const e=this.accounts.filter(o=>o._id===this.account.ownerAccount&&"root"!==o.ownerAccount);this.searchAccountsControl.setValue(`${e[0]?e[0].name:"root"} ${e[0]?"-":""} ${e[0]?e[0].number:""}`.trim())}else this.accountForm.get("level").setValue(this.account?this.account.level+1:0),this.accountForm.get("ownerAccount").setValue(this.account._id),this.searchAccountsControl.setValue(`${"root"!==this.account.ownerAccount?this.account.name:"root"} ${"root"!==this.account.ownerAccount?"-":""} ${"root"!==this.account.ownerAccount?this.account.number:""}`.trim());this.filteredAccounts=this.searchAccountsControl.valueChanges.pipe((0,p.R)(this._unsubscribeAll),(0,X.b)(600),(0,tt.O)(""),(0,v.w)(e=>(0,U.of)(this.accounts.filter(o=>o.name.includes(e)||o.number.toString().includes(e)))))}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}fillOwnerAccounts(e){const o=e.option.value;this.accountForm.get("ownerAccount").setValue(o?o._id:"root"),this.accountForm.get("level").setValue(o?o.level+1:0),this.searchAccountsControl.setValue(o.name+(o.name.includes("root")?"":" - "+o.number))}closeDialog(e,o){this.account=e,this.data.status=o,this.data.account=e,this._dialogRef.close(this.data)}createAccount(){let e=this.accountForm.getRawValue();e=(0,W.omit)(e,["_id","createdAt","updatedAt"]),this._athConfirmationService.open({title:"Crear cuenta",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?",icon:{show:!0,name:"heroicons_outline:question-mark-circle",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().pipe((0,p.R)(this._unsubscribeAll)).subscribe(c=>{"confirmed"===c&&this._accountsService.createAccount(e).pipe((0,p.R)(this._unsubscribeAll)).subscribe(r=>{this._athConfirmationService.open({title:"Confirmaci\xf3n",message:r.message,icon:{show:!0,name:"heroicons_outline:check",color:"success"},actions:{confirm:{show:!0,label:"Ok",color:"primary"},cancel:{show:!1}},dismissible:!1}),this._changeDetectorRef.markForCheck(),this.closeDialog(r.account,"Creado")},r=>{let i;console.warn(r),i=r.error?r.error.message:r.message,this._athConfirmationService.open({title:`${r.statusText}: ${r.status}`,message:i,icon:{show:!0,name:"heroicons_outline:exclamation-circle",color:"error"},actions:{confirm:{show:!0,label:"Ok",color:"primary"},cancel:{show:!1}},dismissible:!1})})})}updateAccount(){const e=this.accountForm.getRawValue();this._athConfirmationService.open({title:"Actualizar cuenta",message:"\xbfEst\xe1 seguro que toda la informaci\xf3n es correcta?."+(this.account.isGroup&&this.account.isGroup!==e.isGroup?"  De existir, se eliminar\xe1n todas las subcuentas":""),icon:{show:!0,name:"heroicons_outline:question-mark-circle",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(c=>{"confirmed"===c&&this._accountsService.updateAccount(e).pipe((0,p.R)(this._unsubscribeAll)).subscribe(r=>{this._athConfirmationService.open({title:"Confirmaci\xf3n",message:r.message,icon:{show:!0,name:"heroicons_outline:check",color:"success"},actions:{confirm:{show:!0,label:"Ok",color:"primary"},cancel:{show:!1}},dismissible:!1}),this.closeDialog(r.account,"Actualizado"),this._changeDetectorRef.markForCheck()},r=>{let i;i=r.error?r.error.message:r.message,this._athConfirmationService.open({title:`${r.statusText}: ${r.status}`,message:i,icon:{show:!0,name:"heroicons_outline:exclamation-circle",color:"error"},actions:{confirm:{show:!0,label:"Ok",color:"primary"},cancel:{show:!1}},dismissible:!1})})})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.WI),t.Y36(Z),t.Y36(t.sBO),t.Y36(x.so),t.Y36(m.QS),t.Y36(M.R),t.Y36(k.yh))},n.\u0275cmp=t.Xpm({type:n,selectors:[["employee-dialog"]],decls:9,vars:4,consts:[[1,"relative","flex","flex-col","w-full","max-h-screen"],[1,"flex","flex-col","items-center","px-8","pt-4","space-y-1","text-center","sm:items-start","sm:mt-0","sm:pr-8","sm:text-left"],["mat-dialog-title","",4,"ngIf"],[1,"flex","flex-col","items-center","flex-auto","w-full","px-8","pb-6"],["class","w-full overflow-hidden",4,"ngIf"],[4,"ngIf"],["mat-dialog-title",""],[1,"w-full","overflow-hidden"],[1,"flex","border-t"],[1,"flex","flex-col","w-full","pt-8",3,"formGroup","autocomplete"],[1,"grid","grid-cols-1","gap-x-4"],[1,""],[1,"w-full"],["matInput","","require","",3,"formControlName","type","placeholder"],["matInput","","type","number","require","",3,"formControlName","placeholder","min"],[1,"mat-form-field-wrapper"],["color","primary",3,"formControlName"],["isGroup",""],["aria-label","String","matInput","","required","",3,"type","placeholder","formControl","matAutocomplete"],["autoActiveFirstOption","",3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["required","",3,"formControlName","placeholder"],["required","",3,"formControlName"],[3,"value"],[1,"flex","items-center","justify-between","w-full","px-8","py-4","bg-gray-50"],["mat-button","",1,"-ml-4","rounded-sm",3,"color","click"],["class","text-mine-900 rounded-sm bg-primary-700","mat-flat-button","",3,"ngClass","disabled","click",4,"ngIf"],["mat-flat-button","",1,"text-mine-900","rounded-sm","bg-primary-700",3,"ngClass","disabled","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.ynx(1),t.TgZ(2,"div",1),t.YNc(3,ct,2,0,"h2",2),t.YNc(4,rt,2,0,"h2",2),t.qZA(),t.BQk(),t.TgZ(5,"div",3),t.ynx(6),t.YNc(7,_t,53,30,"div",4),t.BQk(),t.qZA(),t.YNc(8,At,6,3,"ng-container",5),t.qZA()),2&e&&(t.xp6(3),t.Q6J("ngIf","add"===o.dialogMode),t.xp6(1),t.Q6J("ngIf","edit"===o.dialogMode),t.xp6(3),t.Q6J("ngIf","view"!==o.dialogMode),t.xp6(1),t.Q6J("ngIf","view"!==o.data.dialogMode))},dependencies:[d.mk,d.sg,d.O5,m._Y,m.Fj,m.wV,m.JJ,m.JL,m.Q7,m.qQ,m.oH,m.sg,m.u,y.XC,y.ZL,Q.ey,$.lW,nt.oG,x.uh,g.TO,g.KE,g.bx,g.hX,G.Nt,E.gD,d.Ov],encapsulation:2,changeDetection:0}),n})();var vt=s(29071),bt=s(25245);function Tt(n,a){if(1&n&&(t.TgZ(0,"mat-option",31)(1,"div",32),t._UZ(2,"div",33),t.TgZ(3,"span"),t._uU(4),t.qZA()()()),2&n){const e=a.$implicit;t.Q6J("value",e),t.xp6(4),t.hij(" ",e.name,"")}}const Zt=function(){return["/modules/merchants/new"]};function yt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"mat-form-field")(1,"mat-select",27),t.NdJ("selectionChange",function(c){t.CHM(e);const r=t.oxw();return t.KtG(r.onSelectMerchant(c))}),t.YNc(2,Tt,5,2,"mat-option",28),t.TgZ(3,"mat-option",29)(4,"mat-icon",30),t._uU(5,"add"),t.qZA(),t.TgZ(6,"span"),t._uU(7,"Nuevo negocio"),t.qZA()()()()}if(2&n){const e=a.ngIf,o=t.oxw();t.xp6(1),t.Q6J("value",e[0]),t.xp6(1),t.Q6J("ngForOf",e)("ngForTrackBy",o.trackByFn),t.xp6(1),t.Q6J("routerLink",t.DdM(4,Zt))}}function wt(n,a){if(1&n&&(t.TgZ(0,"span",34),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.selectedMerchant.name)}}function Ot(n,a){if(1&n&&t._UZ(0,"input",35),2&n){const e=t.oxw();t.Q6J("type","text")("placeholder","Filtre por nombre o n\xfamero de cuenta")("formControl",e.searchAccountsControl)}}const B=function(n){return{background:n}},R=function(n){return{display:n}};function Nt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"mat-tree-node",36),t.NdJ("mouseenter",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.doSometing(r.item._id))})("mouseleave",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.doSometing(r.item._id))})("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.doSometingElse(r.item._id,r))}),t.TgZ(1,"mat-icon",37),t._uU(2," assignment "),t.qZA(),t.TgZ(3,"span",38),t._uU(4),t.qZA(),t.TgZ(5,"div",39)(6,"button",40),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.editAccount(r))}),t._uU(7," Editar "),t.TgZ(8,"mat-icon"),t._uU(9,"edit"),t.qZA()(),t.TgZ(10,"button",40),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.deleteAccount(r.item))}),t._uU(11," Eliminar "),t.TgZ(12,"mat-icon"),t._uU(13,"delete_outline"),t.qZA()()(),t.TgZ(14,"span",41),t._uU(15),t.ALo(16,"currency"),t.qZA()()}if(2&n){const e=a.$implicit,o=t.oxw();t.Q6J("ngStyle",t.VKq(11,B,e.item._id===o.overAccountId?"lightgray":e.item._id===o.selectedAccountId?"whitesmoke":"transparent")),t.xp6(4),t.AsE("",e.item.name," - ",e.item.number,""),t.xp6(1),t.Q6J("ngStyle",t.VKq(13,R,e.item._id===o.selectedAccountId||e.item._id===o.overAccountId?"flex":"none")),t.xp6(1),t.Q6J("id",e.item._id),t.xp6(4),t.Q6J("id",e.item._id),t.xp6(5),t.Oqu(t.Dn7(16,7,0,"CUP","symbol"))}}function kt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"mat-tree-node",42),t.NdJ("mouseenter",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.doSometing(r.item._id))})("mouseleave",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.doSometing(r.item._id))})("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.doSometingElse(r.item._id,r))})("dblclick",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.dobleClick(r))}),t.TgZ(1,"button",43),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.expand(r))}),t.TgZ(2,"mat-icon"),t._uU(3),t.qZA()(),t.TgZ(4,"span",44),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.dobleClick(r))}),t._uU(5),t.qZA(),t.TgZ(6,"div",39)(7,"button",40),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.createAccount(r))}),t.TgZ(8,"span",45),t._uU(9,"A\xf1adir"),t.qZA(),t.TgZ(10,"mat-icon"),t._uU(11,"add"),t.qZA()(),t.TgZ(12,"button",40),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.editAccount(r))}),t.TgZ(13,"span",45),t._uU(14,"Editar"),t.qZA(),t.TgZ(15,"mat-icon"),t._uU(16,"edit"),t.qZA()(),t.TgZ(17,"button",40),t.NdJ("click",function(){const r=t.CHM(e).$implicit,i=t.oxw();return t.KtG(i.deleteAccount(r.item))}),t.TgZ(18,"span",45),t._uU(19,"Eliminar"),t.qZA(),t.TgZ(20,"mat-icon"),t._uU(21,"delete_outline"),t.qZA()()(),t.TgZ(22,"span",41),t._uU(23),t.ALo(24,"currency"),t.qZA()()}if(2&n){const e=a.$implicit,o=t.oxw();t.Q6J("ngStyle",t.VKq(13,B,e.item._id===o.overAccountId?"lightgray":e.item._id===o.selectedAccountId?"whitesmoke":"transparent")),t.xp6(1),t.uIk("aria-label","Toggle "+e.item.name),t.xp6(2),t.hij(" ",o.treeControl.isExpanded(e)?"folder_open":"folder"," "),t.xp6(2),t.AsE("",e.item.name," - ",e.item.number,""),t.xp6(1),t.Q6J("ngStyle",t.VKq(15,R,e.item._id===o.selectedAccountId||e.item._id===o.overAccountId?"flex":"none")),t.xp6(1),t.Q6J("id",e.item._id),t.xp6(5),t.Q6J("id",e.item._id),t.xp6(5),t.Q6J("id",e.item._id),t.xp6(6),t.Oqu(t.xi3(24,10,0,"CUP"))}}let St=(()=>{class n{constructor(e,o,c,r,i,u){this._categoriesService=e,this.store=o,this._chartOfAccountDialog=c,this._accountsService=r,this._changeDetectorRef=i,this._athConfirmationService=u,this.merchants=[],this.merchants$=(0,U.of)([]),this.flatNodeMap=new Map,this.nestedNodeMap=new Map,this.selectedParent=null,this.checklistSelection=new L.Ov(!0),this.isSearchDisplayed=!1,this._unsubscribeAll=new w.x,this.getLevel=l=>l.level,this.isExpandable=l=>l.item?l.item.isGroup:l.expandable,this.getChildren=l=>l.children,this.hasChild=(l,f)=>f.item?f.item.isGroup:f.expandable,this.hasNoContent=(l,f)=>""===f.item.name,this.transformer=(l,f)=>{var S;const J=this.nestedNodeMap.get(l),_=J&&J.item===l.item?J:new P;return _.item=l.item,_.level=f,_.expandable=!(null===(S=l.children)||void 0===S||!S.length),this.flatNodeMap.set(_,l),this.nestedNodeMap.set(l,_),_},this.treeFlattener=new h.JZ(this.transformer,this.getLevel,this.isExpandable,this.getChildren),this.treeControl=new H.C2(this.getLevel,this.isExpandable),this.dataSource=new h.kc(this.treeControl,this.treeFlattener),e.dataChange.subscribe(l=>{this.dataSource.data=l})}ngOnInit(){this.merchants$=this.store.select(I.UV),this.merchants$.pipe((0,p.R)(this._unsubscribeAll)).subscribe(e=>{this.merchants=e,this.selectedMerchant=this.merchants[0]})}ngOnDestroy(){this._unsubscribeAll.next(null),this._unsubscribeAll.complete()}descendantsAllSelected(e){const o=this.treeControl.getDescendants(e);return o.length>0&&o.every(r=>this.checklistSelection.isSelected(r))}descendantsPartiallySelected(e){return this.treeControl.getDescendants(e).some(r=>this.checklistSelection.isSelected(r))&&!this.descendantsAllSelected(e)}expand(e){}doSometing(e){this.selectedAccountId=e===this.selectedAccountId?"":e}doSometingElse(e,o){this.overAccountId=e===this.overAccountId?"":e}dobleClick(e){this.treeControl.isExpanded(e)?this.treeControl.collapse(e):(this.expand(e),this.treeControl.expand(e))}deleteAccount(e){this._athConfirmationService.open({title:"Eliminar cuenta",message:`\xbfEst\xe1 seguro que desea eliminar el cuenta ${e.name}?`,icon:{show:!0,name:"heroicons_outline:question-mark-circle",color:"info"},actions:{confirm:{label:"Aceptar",color:"primary"}}}).afterClosed().subscribe(c=>{"confirmed"===c&&this._accountsService.deleteAccount(e._id).subscribe(r=>{!r||(this._athConfirmationService.open({title:"Confirmaci\xf3n",message:`Cuenta ${e.name} eliminado correctamente`,icon:{show:!0,name:"heroicons_outline:check",color:"success"},actions:{confirm:{show:!0,label:"Ok",color:"primary"},cancel:{show:!1}},dismissible:!1}),this._changeDetectorRef.markForCheck())},r=>{console.warn(r),this._athConfirmationService.open({title:`${r.statusText}: ${r.status}`,message:r.error.message,icon:{show:!0,name:"heroicons_outline:exclamation-circle",color:"error"},actions:{confirm:{show:!0,label:"Ok",color:"primary"},cancel:{show:!1}},dismissible:!1})})}),this._changeDetectorRef.markForCheck()}onSelectMerchant(e){const o=e.value;this.selectedMerchant=o,this._accountsService.getAccountsByMerchant(o.id).pipe((0,p.R)(this._unsubscribeAll)).subscribe()}onDisplaySearch(){this.isSearchDisplayed=!this.isSearchDisplayed}expandAll(){this.treeControl.expandAll()}collapseAll(){this.treeControl.collapseAll()}trackByFn(e,o){return o.id||e}createAccount(e){this.openDialog(e||{item:q.emptyAccount()},"add","30%")}editAccount(e){this.openDialog(e,"edit","30%")}openDialog(e,o,c){this._chartOfAccountDialog.open(xt,{data:{account:e.item,merchant:this.selectedMerchant,dialogMode:o},panelClass:"ath-dialog-panel",minWidth:c,maxHeight:"90vh",disableClose:!0}).afterClosed().subscribe(i=>{let u;if(i.status){for(const l of this.flatNodeMap.keys())l.item._id===i.account.ownerAccount&&(u=l);this.treeControl.expand(u)}})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(Z),t.Y36(k.yh),t.Y36(x.uw),t.Y36(Z),t.Y36(t.sBO),t.Y36(M.R))},n.\u0275cmp=t.Xpm({type:n,selectors:[["account-components"]],decls:40,vars:12,consts:[["cdkScrollable","",1,"absolute","inset-0","flex","flex-col","min-w-0","overflow-y-auto"],[1,"flex","flex-col","flex-wrap","p-6","sm:flex-row","flex-0","sm:items-center","sm:justify-between","pb-22","sm:pt-12","sm:pb-28","sm:px-10","bg-mine-50","dark:bg-transparent"],[1,"flex-1","min-w-0"],[1,"flex-wrap","items-center","hidden","font-medium","sm:flex"],[1,"whitespace-nowrap","text-primary-700"],[1,"flex","sm:hidden"],[1,"inline-flex","items-center","-ml-1.5","text-secondary","font-medium",3,"routerLink"],[1,"icon-size-5","text-secondary",3,"svgIcon"],[1,"ml-1"],[1,"mt-2"],[1,"text-3xl","font-extrabold","leading-7","tracking-tight","truncate","md:text-4xl","sm:leading-10"],[1,"flex","items-center","flex-shrink-0","mt-6","sm:mt-0","sm:ml-4"],[4,"ngIf"],[1,"flex-auto","p-6","-mt-16","bg-mine-200","shadow","sm:p-10","rounded-t-2xl"],[1,"w-full","p-8","pt-6","md:p-16","md:pt-8","shadow","rounded-2xl","bg-card","print:w-auto","print:rounded-none","print:shadow-none","print:bg-transparent"],[1,"flex","w-full","pb-10"],[1,"flex","mt-2"],["color","primary",1,"text-4xl"],["class","text-xl font-bold ml-2",4,"ngIf"],[1,"flex","w-full","justify-end"],["color","primary",1,"mr-4","ml-4","text-primary-500",3,"ngClass"],[1,"text-primary-500",3,"ngClass","click"],["class","","aria-label","String","matInput","","required","",3,"type","placeholder","formControl",4,"ngIf"],["mat-stroked-button","","color","primary",1,"ml-2","text-sm",3,"click"],[3,"dataSource","treeControl"],["class","relative","matTreeNodeToggle","","matTreeNodePadding","","matTreeNodePaddingIndent","20",3,"ngStyle","mouseenter","mouseleave","click",4,"matTreeNodeDef"],["class","relative","matTreeNodePadding","","matTreeNodePaddingIndent","20",3,"ngStyle","mouseenter","mouseleave","click","dblclick",4,"matTreeNodeDef","matTreeNodeDefWhen"],[1,"w-auto",3,"value","selectionChange"],[3,"value",4,"ngFor","ngForOf","ngForTrackBy"],[3,"routerLink"],["color","primary"],[3,"value"],[1,"flex"],[1,"w-10"],[1,"text-xl","font-bold","ml-2"],["aria-label","String","matInput","","required","",1,"",3,"type","placeholder","formControl"],["matTreeNodeToggle","","matTreeNodePadding","","matTreeNodePaddingIndent","20",1,"relative",3,"ngStyle","mouseenter","mouseleave","click"],["color","primary",1,"ml-1.5","mr-1.5","text-xl"],[1,"whitespace-nowrap","cursor-default"],[1,"tree-actions",3,"ngStyle"],["mat-stroked-button","","color","primary",3,"id","click"],[1,"absolute","right-3"],["matTreeNodePadding","","matTreeNodePaddingIndent","20",1,"relative",3,"ngStyle","mouseenter","mouseleave","click","dblclick"],["color","primary","mat-icon-button","","matTreeNodeToggle","",3,"click"],[1,"whitespace-nowrap","cursor-pointer",3,"click"],[1,"hidden","sm:block"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"div",3)(5,"div")(6,"a",4),t._uU(7,"Inicio"),t.qZA()()(),t.TgZ(8,"div",5)(9,"a",6),t._UZ(10,"mat-icon",7),t.TgZ(11,"span",8),t._uU(12,"Regresar"),t.qZA()()()(),t.TgZ(13,"div",9)(14,"h2",10),t._uU(15," \xc1rbol de Cuentas "),t.qZA()()(),t.TgZ(16,"div",11),t.YNc(17,yt,8,5,"mat-form-field",12),t.ALo(18,"async"),t.qZA()(),t.TgZ(19,"div",13)(20,"div",14)(21,"div",15)(22,"div",16)(23,"mat-icon",17),t._uU(24,"merchants"),t.qZA(),t.YNc(25,wt,2,1,"span",18),t.qZA(),t.TgZ(26,"div",19)(27,"div",20)(28,"mat-icon",21),t.NdJ("click",function(){return o.onDisplaySearch()}),t._uU(29,"search"),t.qZA(),t.YNc(30,Ot,1,3,"input",22),t.qZA(),t.TgZ(31,"button",23),t.NdJ("click",function(){return o.createAccount(null)}),t._uU(32,"Nueva Cuenta"),t.qZA(),t.TgZ(33,"button",23),t.NdJ("click",function(){return o.expandAll()}),t._uU(34,"Expandir Todo"),t.qZA(),t.TgZ(35,"button",23),t.NdJ("click",function(){return o.collapseAll()}),t._uU(36,"Contraer Todo"),t.qZA()()(),t.TgZ(37,"mat-tree",24),t.YNc(38,Nt,17,15,"mat-tree-node",25),t.YNc(39,kt,25,17,"mat-tree-node",26),t.qZA()()()()),2&e&&(t.xp6(9),t.Q6J("routerLink","./.."),t.xp6(1),t.Q6J("svgIcon","heroicons_solid:chevron-left"),t.xp6(7),t.Q6J("ngIf",t.lcZ(18,10,o.merchants$)),t.xp6(8),t.Q6J("ngIf",o.selectedMerchant),t.xp6(2),t.Q6J("ngClass",o.isSearchDisplayed?"mat-stroked-button text-left text-sm":"flex self-center"),t.xp6(1),t.Q6J("ngClass",o.isSearchDisplayed?"":" cursor-pointer text-3xl"),t.xp6(2),t.Q6J("ngIf",o.isSearchDisplayed),t.xp6(7),t.Q6J("dataSource",o.dataSource)("treeControl",o.treeControl),t.xp6(2),t.Q6J("matTreeNodeDefWhen",o.hasChild))},dependencies:[C.rH,C.yS,d.mk,d.sg,d.O5,d.PC,m.Fj,m.JJ,m.Q7,m.oH,vt.PQ,Q.ey,$.lW,bt.Hw,g.KE,G.Nt,E.gD,h.fQ,h.ah,h.eu,h.gi,h.uo,d.Ov,d.H9],styles:[".tree-actions{display:flex;width:80%!important;justify-content:center!important;position:relative!important}.tree-actions button{margin-left:10px;font-size:12px;max-height:34px!important;min-height:34px!important;max-width:95px!important;align-self:center}.tree-actions button mat-icon{font-size:20px}\n"],encapsulation:2,changeDetection:0}),n})();var Jt=s(95915),Ft=s(71329);const Ut=[{path:"",component:St,resolve:{accounts:(()=>{class n{constructor(e,o,c,r,i){this._merchantService=e,this._accountService=o,this._router=c,this.store=r,this._userService=i,this._unsubscribeAll=new w.x,this.store.select(I.UV).pipe((0,p.R)(this._unsubscribeAll)).subscribe(u=>{this._merchants=u})}resolve(e,o){return this._accountService.getAccountsByMerchant(this._merchants[0].id)}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(Jt.S),t.LFG(Z),t.LFG(C.F0),t.LFG(k.yh),t.LFG(Ft.K))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()}}];let It=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[C.Bz.forChild(Ut),K.m,h.dp,y.Bb]}),n})()}}]);